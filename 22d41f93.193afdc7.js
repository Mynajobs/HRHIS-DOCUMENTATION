(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{73:function(e,t,a){"use strict";a.r(t),a.d(t,"frontMatter",(function(){return o})),a.d(t,"metadata",(function(){return l})),a.d(t,"toc",(function(){return s})),a.d(t,"default",(function(){return p}));var n=a(3),r=a(7),i=(a(0),a(93)),o={id:"records",title:"Records Module",sidebar_label:"Records"},l={unversionedId:"developers/data/records",id:"developers/data/records",isDocsHomePage:!1,title:"Records Module",description:"Record Duplicates and Merging API",source:"@site/docs/developers/data/records.md",slug:"/developers/data/records",permalink:"/hris-api-docs/docs/developers/data/records",editUrl:"https://github.com/hisptz/hris-api-docs/blob/main/docs/developers/data/records.md",version:"current",sidebar_label:"Records",sidebar:"menuSidebar",previous:{title:"Indicators",permalink:"/hris-api-docs/docs/developers/metadata/indicators"},next:{title:"Analytics",permalink:"/hris-api-docs/docs/developers/data/analytics"}},s=[{value:"Record Duplicates and Merging API",id:"record-duplicates-and-merging-api",children:[]},{value:"Get Duplicate Records.",id:"get-duplicate-records",children:[]},{value:"Merging Duplicates",id:"merging-duplicates",children:[{value:"Scenario One || Based on Records",id:"scenario-one--based-on-records",children:[]},{value:"Scenario One || Based on Selected Fields",id:"scenario-one--based-on-selected-fields",children:[]}]},{value:"Data values",id:"data-values",children:[{value:"Sending data values",id:"sending-data-values",children:[]},{value:"Sending bulks of data values",id:"sending-bulks-of-data-values",children:[]},{value:"Import parameters",id:"import-parameters",children:[]},{value:"CSV data value format",id:"csv-data-value-format",children:[]},{value:"Generating data value set template",id:"generating-data-value-set-template",children:[]},{value:"Reading data values",id:"reading-data-values",children:[]},{value:"Sending, reading and deleting individual data values",id:"sending-reading-and-deleting-individual-data-values",children:[]}]}],d={toc:s};function p(e){var t=e.components,a=Object(r.a)(e,["components"]);return Object(i.b)("wrapper",Object(n.a)({},d,a,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h3",{id:"record-duplicates-and-merging-api"},"Record Duplicates and Merging API"),Object(i.b)("h2",{id:"get-duplicate-records"},"Get Duplicate Records."),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Endpoint")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-JS"},"/api/records/duplicates/hshD7171OpG\n")),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Where ",Object(i.b)("inlineCode",{parentName:"p"},"hshD7171OpG")," is the form id.")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Method:")," GET"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Payload")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-JSON"},' {\n  "pager": {\n    "page": 1,\n    "pageSize": 100,\n    "pageCount": 00,\n    "total": 1295,\n    "nextPage": "/api/records/duplicates/52893cd128bd2?page=2"\n  },\n  "records": [\n      {\n      "field": "b2fkEQgzJdbhF",\n      "name": "Check Number",\n      "duplicates": [\n        {\n          "id": "BPlMPfo553ch5",\n          "recordValues": [\n             {\n               "id": "nuDEzu4NBeL2Z",\n              "field": "iKJDfOQmtw2qp",\n              "value": "form four"\n            },\n            {\n              "id": "eTnrhDx2E45EG",\n              "field": "lJNeQk2bTNQl5",\n              "value": "jdjjd"\n            },\n          ],\n          "organisationunit": "zRgNXkU7Yef6L"\n        },\n        {\n          "id": "SspS99jTdRbn8",\n          "recordValues": [\n           {\n             "id":"kmfZvkYLiOWVu",\n              "field": "nTw32YiWJtwhl",\n              "value": "jdjjd"\n            },\n            {\n              "id":"ezFEgOAnPWNvs",\n              "field": "tRPYrDlb1n79w",\n              "value": "ndnndf"\n            },\n            {\n              "id":"E7NeVciipvtMv",\n              "field": "lWDS8Rwg70G9I",\n              "value": "nam"\n            }\n          ],\n          "organisationunit": "PXXhx3rjw6ebx"\n        }\n      ]\n    }\n  ]\n }\n')),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Payload Description")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The payload contains an array of Records and inside, objects. Each object contains a random character string value with key field which indicates the unique field used to get duplicates."),Object(i.b)("li",{parentName:"ul"},"The same object contains another object with properties of id and recordValues, these indicate the record id and it's associated values respectively.")),Object(i.b)("h2",{id:"merging-duplicates"},"Merging Duplicates"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"Duplicates can be merged by two scenarios.")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Endpoint")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-JS"},"/api/records/merge\n")),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Method:")," POST"),Object(i.b)("h3",{id:"scenario-one--based-on-records"},"Scenario One || Based on Records"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Payload")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-JSON"},'{\n  "keep": "wuWlL5gTuzUf4",\n  "remove":["yxd7nZx3dExX9","ephzmm10i8Olc"]\n}\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Where ",Object(i.b)("inlineCode",{parentName:"p"},"keep")," represents the recordid to keep and ",Object(i.b)("inlineCode",{parentName:"p"},"remove")," represents an array of record ids to delete")),Object(i.b)("h3",{id:"scenario-one--based-on-selected-fields"},"Scenario One || Based on Selected Fields"),Object(i.b)("p",null,Object(i.b)("inlineCode",{parentName:"p"},"Payload")),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-JSON"},'{\n  "organisationUnit":"XJpzOmbg7LuL6",\n  "form": "iJUMeqloMjmDq",\n  "recordValues": [\n      {"id": "jJBwwcYa1kBzQ"},\n      {"id": "fEbTGVMKVLUTU"},\n      {"id": "nlG8zObKlkMcx"}\n      ],\n  "remove":["yxd7nZx3dExX9","ephzmm10i8Olc"]\n}\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},"Where organisationUnit represents and form represents the parameters of the new record to create ",Object(i.b)("inlineCode",{parentName:"p"},"recordValues")," represents an array of all recordvalue ids for all fields to create a new record and ",Object(i.b)("inlineCode",{parentName:"p"},"remove")," represents an array of record ids to delete")),Object(i.b)("h2",{id:"data-values"},"Data values"),Object(i.b)("p",null,"This section is about sending and reading data values."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets\n")),Object(i.b)("h3",{id:"sending-data-values"},"Sending data values"),Object(i.b)("p",null,"A common use-case for system integration is the need to send a set of\ndata values from a third-party system into DHIS. In this example, we will\nuse the HRHIS4 demo on ",Object(i.b)("inlineCode",{parentName:"p"},"http://dev.hrhis.dhis2udsm.org/demo")," as basis. We assume\nthat we have collected case-based data using a simple software client\nrunning on mobile phones for the ",Object(i.b)("em",{parentName:"p"},"Mortality <5 years")," data set in the\ncommunity of ",Object(i.b)("em",{parentName:"p"},"Ngelehun CHC")," (in ",Object(i.b)("em",{parentName:"p"},"Badjia")," chiefdom, ",Object(i.b)("em",{parentName:"p"},"Bo")," district) for\nthe month of January 2014. We have now aggregated our data into a\nstatistical report and want to send that data to the HRHIS4 instance. The\nbase URL to the demo API is ",Object(i.b)("inlineCode",{parentName:"p"},"http://dev.hrhis.dhis2udsm.org/demo/api"),". The following\nlinks are relative to the base URL."),Object(i.b)("p",null,"The resource which is most appropriate for our purpose of sending data\nvalues is the ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataValueSets")," resource. A data value set represents a\nset of data values which have a relationship, usually from being\ncaptured off the same data entry form. The format looks like\nthis:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0" dataSet="dataSetID"\n  completeDate="date" period="period" orgUnit="orgUnitID" attributeOptionCombo="aocID">\n  <dataValue dataElement="dataElementID" \n    categoryOptionCombo="cocID" value="1" comment="comment1"/>\n  <dataValue dataElement="dataElementID" \n    categoryOptionCombo="cocID" value="2" comment="comment2"/>\n  <dataValue dataElement="dataElementID" \n    categoryOptionCombo="cocID" value="3" comment="comment3"/>\n</dataValueSet>\n')),Object(i.b)("p",null,"JSON is supported in this format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "dataSet": "dataSetID",\n  "completeDate": "date",\n  "period": "period",\n  "orgUnit": "orgUnitID",\n  "attributeOptionCombo": "aocID",\n  "dataValues": [\n    {\n      "dataElement": "dataElementID", \n      "categoryOptionCombo": "cocID", \n      "value": "1", \n      "comment": "comment1"\n    },\n    {\n      "dataElement": "dataElementID", \n      "categoryOptionCombo": "cocID", \n      "value": "2", \n      "comment": "comment2"\n    },\n    {\n      "dataElement": "dataElementID", \n      "categoryOptionCombo": "cocID", \n      "value": "3", \n      "comment": "comment3"\n    }\n  ]\n}\n')),Object(i.b)("p",null,"CSV is supported in this format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-csv"},'"dataelement","period","orgunit","catoptcombo","attroptcombo","value","strby","lstupd","cmt"\n"dataElementID","period","orgUnitID","cocID","aocID","1","username","2015-04-01","comment1"\n"dataElementID","period","orgUnitID","cocID","aocID","2","username","2015-04-01","comment2"\n"dataElementID","period","orgUnitID","cocID","aocID","3","username","2015-04-01","comment3"\n')),Object(i.b)("blockquote",null,Object(i.b)("p",{parentName:"blockquote"},Object(i.b)("strong",{parentName:"p"},"Note")),Object(i.b)("p",{parentName:"blockquote"},"Please refer to the date and period section above for time formats.")),Object(i.b)("p",null,"From the example, we can see that we need to identify the period, the\ndata set, the org unit (facility) and the data elements for which to\nreport."),Object(i.b)("p",null,"To obtain the identifier for the data set we make a request to the\n",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataSets")," resource. From there we find and follow the link to\nthe ",Object(i.b)("em",{parentName:"p"},"Mortality < 5 years")," data set which leads us to ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataSets/pBOMPrpg1QX"),".\nThe resource representation for the ",Object(i.b)("em",{parentName:"p"},"Mortality < 5 years")," data set conveniently\nadvertises links to the data elements which are members of it. From here\nwe can follow these links and obtain the identifiers of the data\nelements. For brevity we will only report on three data elements:\n",Object(i.b)("em",{parentName:"p"},"Measles")," with id ",Object(i.b)("inlineCode",{parentName:"p"},"f7n9E0hX8qk"),", ",Object(i.b)("em",{parentName:"p"},"Dysentery")," with id ",Object(i.b)("inlineCode",{parentName:"p"},"Ix2HsbDMLea")," and\n",Object(i.b)("em",{parentName:"p"},"Cholera")," with id ",Object(i.b)("inlineCode",{parentName:"p"},"eY5ehpbEsB7"),"."),Object(i.b)("p",null,"What remains is to get hold of the identifier of the organisation\nunit. The ",Object(i.b)("em",{parentName:"p"},"dataSet")," representation conveniently provides a link to organisation\nunits which report on it so we search for ",Object(i.b)("em",{parentName:"p"},"Ngelehun CHC")," and follow the\nlink to the HTML representation at ",Object(i.b)("inlineCode",{parentName:"p"},"/api/organisationUnits/DiszpKrYNg8"),", which\ntells us that the identifier of this org unit is ",Object(i.b)("inlineCode",{parentName:"p"},"DiszpKrYNg8"),"."),Object(i.b)("p",null,"From our case-based data, we assume that we have 12 cases of measles, 14\ncases of dysentery and 16 cases of cholera. We have now gathered enough\ninformation to be able to put together the XML data value set\nmessage:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0" dataSet="pBOMPrpg1QX"\n  completeDate="2014-02-03" period="201401" orgUnit="DiszpKrYNg8">\n  <dataValue dataElement="f7n9E0hX8qk" value="12"/>\n  <dataValue dataElement="Ix2HsbDMLea" value="14"/>\n  <dataValue dataElement="eY5ehpbEsB7" value="16"/>\n</dataValueSet>\n')),Object(i.b)("p",null,"In JSON format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "dataSet": "pBOMPrpg1QX",\n  "completeDate": "2014-02-03",\n  "period": "201401",\n  "orgUnit": "DiszpKrYNg8",\n  "dataValues": [\n    {\n      "dataElement": "f7n9E0hX8qk", \n      "value": "1"\n    },\n    {\n      "dataElement": "Ix2HsbDMLea", \n      "value": "2"\n    },\n    {\n      "dataElement": "eY5ehpbEsB7", \n      "value": "3"\n    }\n  ]\n}\n')),Object(i.b)("p",null,"To perform functional testing we will use the ",Object(i.b)("em",{parentName:"p"},"curl")," tool which provides\nan easy way of transferring data using HTTP. First, we save the data\nvalue set XML content in a file called ",Object(i.b)("inlineCode",{parentName:"p"},"datavalueset.xml"),". From the\ndirectory where this file resides we invoke the following from the\ncommand line:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl -d @datavalueset.xml "https://dev.hrhis.dhis2udsm.org/demo/api/dataValueSets"\n  -H "Content-Type:application/xml" -u admin:district\n')),Object(i.b)("p",null,"For sending JSON content you must set the content-type header\naccordingly:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl -d @datavalueset.json "https://dev.hrhis.dhis2udsm.org/demo/api/dataValueSets"\n  -H "Content-Type:application/json" -u admin:district\n')),Object(i.b)("p",null,"The command will dispatch a request to the demo Web API, set\n",Object(i.b)("inlineCode",{parentName:"p"},"application/xml")," as the content-type and authenticate using\n",Object(i.b)("inlineCode",{parentName:"p"},"admin"),"/",Object(i.b)("inlineCode",{parentName:"p"},"district")," as username/password. If all goes well this will return a\n",Object(i.b)("inlineCode",{parentName:"p"},"200 OK")," HTTP status code. You can verify that the data has been\nreceived by opening the data entry module in HRHIS4 and select the org\nunit, data set and period used in this example."),Object(i.b)("p",null,"The API follows normal semantics for error handling and HTTP status\ncodes. If you supply an invalid username or password, ",Object(i.b)("inlineCode",{parentName:"p"},"401 Unauthorized"),"\nis returned. If you supply a content-type other than ",Object(i.b)("inlineCode",{parentName:"p"},"application/xml"),",\n",Object(i.b)("inlineCode",{parentName:"p"},"415 Unsupported Media Type")," is returned. If the XML content is invalid\naccording to the DXF namespace, ",Object(i.b)("inlineCode",{parentName:"p"},"400 Bad Request")," is returned. If you\nprovide an invalid identifier in the XML content, ",Object(i.b)("inlineCode",{parentName:"p"},"409 Conflict")," is\nreturned together with a descriptive message."),Object(i.b)("h3",{id:"sending-bulks-of-data-values"},"Sending bulks of data values"),Object(i.b)("p",null,"The previous example showed us how to send a set of related data values\nsharing the same period and organisation unit. This example will show us\nhow to send large bulks of data values which don't necessarily are\nlogically related."),Object(i.b)("p",null,"Again we will interact with the ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataValueSets")," resource. This time we\nwill not specify the ",Object(i.b)("inlineCode",{parentName:"p"},"dataSet")," and ",Object(i.b)("inlineCode",{parentName:"p"},"completeDate")," attributes. Also, we will\nspecify the ",Object(i.b)("inlineCode",{parentName:"p"},"period")," and ",Object(i.b)("inlineCode",{parentName:"p"},"orgUnit")," attributes on the individual data value\nelements instead of on the outer data value set element. This will\nenable us to send data values for various periods and organisation units:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0">\n  <dataValue dataElement="f7n9E0hX8qk" \n    period="201401" orgUnit="DiszpKrYNg8" value="12"/>\n  <dataValue dataElement="f7n9E0hX8qk" \n    period="201401" orgUnit="FNnj3jKGS7i" value="14"/>\n  <dataValue dataElement="f7n9E0hX8qk" \n    period="201402" orgUnit="DiszpKrYNg8" value="16"/>\n  <dataValue dataElement="f7n9E0hX8qk" \n    period="201402" orgUnit="Jkhdsf8sdf4" value="18"/>\n</dataValueSet>\n')),Object(i.b)("p",null,"In JSON format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "dataValues": [\n    {\n      "dataElement": "f7n9E0hX8qk", \n      "period": "201401", \n      "orgUnit": "DiszpKrYNg8", \n      "value": "12"\n    }, \n    {\n      "dataElement": "f7n9E0hX8qk", \n      "period": "201401", \n      "orgUnit": "FNnj3jKGS7i", \n      "value": "14"\n    }, \n    {\n      "dataElement": "f7n9E0hX8qk", \n      "period": "201402", \n      "orgUnit": "DiszpKrYNg8", \n      "value": "16"\n    }, \n    {\n      "dataElement": "f7n9E0hX8qk", \n      "period": "201402", \n      "orgUnit": "Jkhdsf8sdf4", \n      "value": "18"\n    }\n  ]\n}\n')),Object(i.b)("p",null,"In CSV format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-csv"},'"dataelement","period","orgunit","categoryoptioncombo","attributeoptioncombo","value"\n"f7n9E0hX8qk","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","1"\n"Ix2HsbDMLea","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","2"\n"eY5ehpbEsB7","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","3"\n')),Object(i.b)("p",null,"We test by using curl to send the data values in XML format:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl -d @datavalueset.xml "https://dev.hrhis.dhis2udsm.org/demo/api/dataValueSets"\n  -H "Content-Type:application/xml" -u admin:district\n')),Object(i.b)("p",null,"Note that when using CSV format you must use the binary data option to\npreserve the line-breaks in the CSV file:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl --data-binary @datavalueset.csv "https://dev.hrhis.dhis2udsm.org/demo/24/api/dataValueSets"\n  -H "Content-Type:application/csv" -u admin:district\n')),Object(i.b)("p",null,"The data value set resource provides an XML response which is useful\nwhen you want to verify the impact your request had. The first time we\nsend the data value set request above the server will respond with the\nfollowing import summary:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<importSummary>\n  <dataValueCount imported="2" updated="1" ignored="1"/>\n  <dataSetComplete>false</dataSetComplete>\n</importSummary>\n')),Object(i.b)("p",null,"This message tells us that 3 data values were imported, 1 data value was\nupdated while zero data values were ignored. The single update comes as\na result of us sending that data value in the previous example. A data\nvalue will be ignored if it references a non-existing data element,\nperiod, org unit or data set. In our case, this single ignored value was\ncaused by the last data value having an invalid reference to org unit.\nThe data set complete element will display the date of which the data\nvalue set was completed, or false if no data element attribute was\nsupplied."),Object(i.b)("h3",{id:"import-parameters"},"Import parameters"),Object(i.b)("p",null,"The import process can be customized using a set of import parameters:"),Object(i.b)("p",null,"All parameters are optional and can be supplied as query parameters in\nthe request URL like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets?dataElementIdScheme=code&orgUnitIdScheme=name\n  &dryRun=true&importStrategy=CREATE\n")),Object(i.b)("p",null,"They can also be supplied as XML attributes on the data value set\nelement like below. XML attributes will override query string\nparameters."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0" dataElementIdScheme="code"\n  orgUnitIdScheme="name" dryRun="true" importStrategy="CREATE">\n</dataValueSet>\n')),Object(i.b)("p",null,"Note that the ",Object(i.b)("inlineCode",{parentName:"p"},"preheatCache")," parameter can have a huge impact on\nperformance. For small import files, leaving it to false will be fast.\nFor large import files which contain a large number of distinct data\nelements and organisation units, setting it to true will be orders of\nmagnitude faster."),Object(i.b)("h4",{id:"data-value-requirements"},"Data value requirements"),Object(i.b)("p",null,"Data value import supports a set of value types. For each value type,\nthere is a special requirement. The following table lists the edge cases\nfor value types."),Object(i.b)("h4",{id:"identifier-schemes"},"Identifier schemes"),Object(i.b)("p",null,"Regarding the id schemes, by default the identifiers used in the XML\nmessages use the HRHIS4 stable object identifiers referred to as ",Object(i.b)("inlineCode",{parentName:"p"},"UID"),".\nIn certain interoperability situations we might experience that an external\nsystem decides the identifiers of the objects. In that case we can use\nthe ",Object(i.b)("inlineCode",{parentName:"p"},"code")," property of the organisation units and other objects to set\nfixed identifiers. When importing data values we hence need to reference\nthe code property instead of the identifier property of these metadata\nobjects. Identifier schemes can be specified in the XML message as well\nas in the request as query parameters. To specify it in the XML payload\nyou can do this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0"\n  dataElementIdScheme="CODE" orgUnitIdScheme="UID" idScheme="CODE">\n</dataValueSet>\n')),Object(i.b)("p",null,"The parameter table above explains how the id schemes can be specified\nas query parameters. The following rules apply for what takes\nprecedence:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Id schemes defined in the XML or JSON payload take precedence over\nid schemes defined as URL query parameters.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Specific id schemes including dataElementIdScheme and\norgUnitIdScheme take precedence over the general idScheme.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"The default id scheme is UID, which will be used if no explicit id\nscheme is defined."))),Object(i.b)("p",null,"The following identifier schemes are available."),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"uid (default)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"code")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"name")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"attribute (followed by UID of attribute)"))),Object(i.b)("p",null,"The attribute option is special and refers to meta-data attributes which\nhave been marked as ",Object(i.b)("em",{parentName:"p"},"unique"),". When using this option, ",Object(i.b)("inlineCode",{parentName:"p"},"attribute"),' must\nbe immediately followed by the identifier of the attribute, e.g.\n"attribute:DnrLSdo4hMl".'),Object(i.b)("h4",{id:"async-data-value-import"},"Async data value import"),Object(i.b)("p",null,"Data values can be sent and imported in an asynchronous fashion by\nsupplying an ",Object(i.b)("inlineCode",{parentName:"p"},"async")," query parameter set to ",Object(i.b)("em",{parentName:"p"},"true"),":"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets?async=true\n")),Object(i.b)("p",null,"This will initiate an asynchronous import job for which you can monitor\nthe status at the task summaries API. The API response indicates the\nunique identifier of the job, type of job and the URL you can use to\nmonitor the import job status. The response will look similar to this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "httpStatus": "OK",\n  "httpStatusCode": 200,\n  "status": "OK",\n  "message": "Initiated dataValueImport",\n  "response": {\n    "name": "dataValueImport",\n    "id": "YR1UxOUXmzT",\n    "created": "2018-08-20T14:17:28.429",\n    "jobType": "DATAVALUE_IMPORT",\n    "relativeNotifierEndpoint": "/api/system/tasks/DATAVALUE_IMPORT/YR1UxOUXmzT"\n  }\n}\n')),Object(i.b)("p",null,"Please read the section on ",Object(i.b)("em",{parentName:"p"},"asynchronous task status")," for more\ninformation."),Object(i.b)("h3",{id:"csv-data-value-format"},"CSV data value format"),Object(i.b)("p",null,"The following section describes the CSV format used in HRHIS4. The first\nrow is assumed to be a header row and will be ignored during import."),Object(i.b)("p",null,"An example of a CSV file which can be imported into HRHIS4 is seen below."),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-csv"},'"dataelement","period","orgunit","catoptcombo","attroptcombo","value","storedby","timestamp"\n"DUSpd8Jq3M7","201202","gP6hn503KUX","Prlt0C1RF0s",,"7","bombali","2010-04-17"\n"DUSpd8Jq3M7","201202","gP6hn503KUX","V6L425pT3A0",,"10","bombali","2010-04-17"\n"DUSpd8Jq3M7","201202","OjTS752GbZE","V6L425pT3A0",,"9","bombali","2010-04-06"\n')),Object(i.b)("h3",{id:"generating-data-value-set-template"},"Generating data value set template"),Object(i.b)("p",null,"To generate a data value set template for a certain data set you can use\nthe ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataSets/<id>/dataValueSet")," resource. XML and JSON response\nformats are supported. Example:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataSets/BfMAe6Itzgt/dataValueSet.json\n")),Object(i.b)("p",null,"The parameters you can use to further adjust the output are described\nbelow:"),Object(i.b)("h3",{id:"reading-data-values"},"Reading data values"),Object(i.b)("p",null,"This section explains how to retrieve data values from the Web API by\ninteracting with the ",Object(i.b)("em",{parentName:"p"},"dataValueSets")," resource. Data values can be\nretrieved in ",Object(i.b)("em",{parentName:"p"},"XML"),", ",Object(i.b)("em",{parentName:"p"},"JSON")," and ",Object(i.b)("em",{parentName:"p"},"CSV")," format. Since we want to read data\nwe will use the ",Object(i.b)("em",{parentName:"p"},"GET")," HTTP verb. We will also specify that we are\ninterested in the XML resource representation by including an ",Object(i.b)("inlineCode",{parentName:"p"},"Accept"),"\nHTTP header with our request. The following query parameters are\nrequired:"),Object(i.b)("p",null,"The following response formats are supported:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"xml (application/xml)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"json (application/json)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"csv (application/csv)")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"adx (application/adx+xml)"))),Object(i.b)("p",null,"Assuming that we have posted data values to HRHIS4 according to the\nprevious section called ",Object(i.b)("em",{parentName:"p"},"Sending data values")," we can now put together\nour request for a single data value set and request it using cURL:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.dhis2udsm.org/demo/api/dataValueSets?dataSet=pBOMPrpg1QX&period=201401&orgUnit=DiszpKrYNg8"\n  -H "Accept:application/xml" -u admin:district\n')),Object(i.b)("p",null,"We can also use the start and end dates query parameters to request a\nlarger bulk of data values. I.e. you can also request data values for\nmultiple data sets and org units and a time span in order to export\nlarger chunks of data. Note that the period query parameter takes\nprecedence over the start and end date parameters. An example looks like\nthis:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.dhis2udsm.org/demo/api/dataValueSets?dataSet=pBOMPrpg1QX&dataSet=BfMAe6Itzgt\n  &startDate=2013-01-01&endDate=2013-01-31&orgUnit=YuQRtpLP10I&orgUnit=vWbkYPRmKyS&children=true"\n  -H "Accept:application/xml" -u admin:district\n')),Object(i.b)("p",null,"To retrieve data values which have been created or updated within the\nlast 10 days you can make a request like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets?dataSet=pBOMPrpg1QX&orgUnit=DiszpKrYNg8&lastUpdatedDuration=10d\n")),Object(i.b)("p",null,"The response will look like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-xml"},'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<dataValueSet xmlns="http://HRHIS4.org/schema/dxf/2.0" dataSet="pBOMPrpg1QX"\n  completeDate="2014-01-02" period="201401" orgUnit="DiszpKrYNg8">\n<dataValue dataElement="eY5ehpbEsB7" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10003"/>\n<dataValue dataElement="Ix2HsbDMLea" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10002"/>\n<dataValue dataElement="f7n9E0hX8qk" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10001"/>\n</dataValueSet>\n')),Object(i.b)("p",null,"You can request the data in JSON format like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets.json?dataSet=pBOMPrpg1QX&period=201401&orgUnit=DiszpKrYNg8\n")),Object(i.b)("p",null,"The response will look something like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-json"},'{\n  "dataSet": "pBOMPrpg1QX",\n  "completeDate": "2014-02-03",\n  "period": "201401",\n  "orgUnit": "DiszpKrYNg8",\n  "dataValues": [\n    {\n      "dataElement": "eY5ehpbEsB7", \n      "categoryOptionCombo": "bRowv6yZOF2", \n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8", \n      "value": "10003"\n    }, \n    {\n      "dataElement": "Ix2HsbDMLea", \n      "categoryOptionCombo": "bRowv6yZOF2", \n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8", \n      "value": "10002"\n    }, \n    {\n      "dataElement": "f7n9E0hX8qk", \n      "categoryOptionCombo": "bRowv6yZOF2", \n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8", \n      "value": "10001"\n    }\n  ]\n}\n')),Object(i.b)("p",null,"Note that data values are softly deleted, i.e. a deleted value has the\n",Object(i.b)("inlineCode",{parentName:"p"},"deleted")," property set to true instead of being permanently deleted.\nThis is useful when integrating multiple systems in order to communicate\ndeletions. You can include deleted values in the response like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets.json?dataSet=pBOMPrpg1QX&period=201401\n  &orgUnit=DiszpKrYNg8&includeDeleted=true\n")),Object(i.b)("p",null,"You can also request data in CSV format like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValueSets.csv?dataSet=pBOMPrpg1QX&period=201401\n  &orgUnit=DiszpKrYNg8\n")),Object(i.b)("p",null,"The response will look like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-csv"},"dataelement,period,orgunit,catoptcombo,attroptcombo,value,storedby,lastupdated,comment,flwup\nf7n9E0hX8qk,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,12,system,2015-04-05T19:58:12.000,comment1,false\nIx2HsbDMLea,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,14,system,2015-04-05T19:58:12.000,comment2,false\neY5ehpbEsB7,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,16,system,2015-04-05T19:58:12.000,comment3,false\nFTRrcoaog83,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,12,system,2014-03-02T21:45:05.519,comment4,false\n")),Object(i.b)("p",null,"The following constraints apply to the data value sets resource:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"At least one data set must be specified.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Either at least one period or a start date and end date must be\nspecified.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"At least one organisation unit must be specified.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Organisation units must be within the hierarchy of the organisation\nunits of the authenticated user.")),Object(i.b)("li",{parentName:"ul"},Object(i.b)("p",{parentName:"li"},"Limit cannot be less than zero."))),Object(i.b)("h3",{id:"sending-reading-and-deleting-individual-data-values"},"Sending, reading and deleting individual data values"),Object(i.b)("p",null,"This example will show how to send individual data values to be saved in\na request. This can be achieved by sending a ",Object(i.b)("em",{parentName:"p"},"POST")," request to the\n",Object(i.b)("inlineCode",{parentName:"p"},"dataValues")," resource:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre"},"/api/dataValues\n")),Object(i.b)("p",null,"The following query parameters are supported for this resource:"),Object(i.b)("p",null,"If any of the identifiers given are invalid, if the data value or\ncomment is invalid or if the data is locked, the response will contain\nthe ",Object(i.b)("em",{parentName:"p"},"409 Conflict")," status code and descriptive text message. If the\noperation leads to a saved or updated value, ",Object(i.b)("em",{parentName:"p"},"200 OK")," will be returned.\nAn example of a request looks like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.dhis2udsm.org/demo/api/dataValues?de=s46m5MS0hxu\n  &pe=201301&ou=DiszpKrYNg8&co=Prlt0C1RF0s&value=12"\n  -X POST -u admin:district\n')),Object(i.b)("p",null,"This resource also allows a special syntax for associating the value to\nan attribute option combination. This can be done by sending the\nidentifier of the attribute category combination, together with the identifiers\nof the attribute category options which the value represents within the\ncombination. The category combination is specified with the ",Object(i.b)("inlineCode",{parentName:"p"},"cc")," parameter, while\nthe category options are specified as a semi-colon separated string with the ",Object(i.b)("inlineCode",{parentName:"p"},"cp"),"\nparameter. It is necessary to ensure that the category options are all part\nof the category combination. An example looks like this:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.dhis2udsm.org/demo/api/dataValues?de=s46m5MS0hxu&ou=DiszpKrYNg8\n  &pe=201308&cc=dzjKKQq0cSO&cp=wbrDrL2aYEc;btOyqprQ9e8&value=26"\n  -X POST -u admin:district\n')),Object(i.b)("p",null,"You can retrieve a data value with a request using the ",Object(i.b)("em",{parentName:"p"},"GET")," method. The\nvalue, comment and followUp params are not applicable in this regard:"),Object(i.b)("pre",null,Object(i.b)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.dhis2udsm.org/demo/api/dataValues?de=s46m5MS0hxu\n  &pe=201301&ou=DiszpKrYNg8&co=Prlt0C1RF0s"\n  -u admin:district\n')),Object(i.b)("p",null,"You can delete a data value with a request using the ",Object(i.b)("em",{parentName:"p"},"DELETE")," method."),Object(i.b)("h4",{id:"working-with-file-data-values"},"Working with file data values"),Object(i.b)("p",null,"When dealing with data values which have a data element of type ",Object(i.b)("em",{parentName:"p"},"file"),"\nthere is some deviation from the method described above. These data\nvalues are special in that the contents of the value is a UID reference\nto a ",Object(i.b)("em",{parentName:"p"},"FileResource")," object instead of a self-contained constant. These\ndata values will behave just like other data values which store text\ncontent, but should be handled differently in order to produce\nmeaningful input and output."),Object(i.b)("p",null,"The process of storing one of these data values roughly goes like this:"),Object(i.b)("ol",null,Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Upload the file to the ",Object(i.b)("inlineCode",{parentName:"p"},"/api/fileResources")," endpoint as described\nin the file resource section.")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Retrieve the ",Object(i.b)("inlineCode",{parentName:"p"},"id")," property of the returned ",Object(i.b)("em",{parentName:"p"},"FileResource"),".")),Object(i.b)("li",{parentName:"ol"},Object(i.b)("p",{parentName:"li"},"Store the retrieved id ",Object(i.b)("em",{parentName:"p"},"as the value")," to the data value using any\nof the methods described above."))),Object(i.b)("p",null,"Only one-to-one relationships between data values and file resources are\nallowed. This is enforced internally so that saving a file resource id\nin several data values is not allowed and will return an error. Deleting\nthe data value will delete the referenced file resource. Direct deletion\nof file resources are not possible."),Object(i.b)("p",null,"The data value can now be retrieved as any other but the returned data\nwill be the UID of the file resource. In order to retrieve the actual\ncontents (meaning the file which is stored in the file resource mapped\nto the data value) a GET request must be made to ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataValues/files"),"\nmirroring the query parameters as they would be for the data value\nitself. The ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataValues/files")," endpoint only supports GET requests."),Object(i.b)("p",null,"It is worth noting that due to the underlying storage mechanism working\nasynchronously the file content might not be immediately ready for\ndownload from the ",Object(i.b)("inlineCode",{parentName:"p"},"/api/dataValues/files")," endpoint. This is especially true\nfor large files which might require time consuming uploads happening in\nthe background to an external file store (depending on the system\nconfiguration). Retrieving the file resource meta-data from the\n",Object(i.b)("inlineCode",{parentName:"p"},"/api/fileResources/<id>")," endpoint allows checking the ",Object(i.b)("inlineCode",{parentName:"p"},"storageStatus"),"\nof the content before attempting to download it."))}p.isMDXComponent=!0},93:function(e,t,a){"use strict";a.d(t,"a",(function(){return c})),a.d(t,"b",(function(){return m}));var n=a(0),r=a.n(n);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function l(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function s(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var d=r.a.createContext({}),p=function(e){var t=r.a.useContext(d),a=t;return e&&(a="function"==typeof e?e(t):l(l({},t),e)),a},c=function(e){var t=p(e.components);return r.a.createElement(d.Provider,{value:t},e.children)},b={inlineCode:"code",wrapper:function(e){var t=e.children;return r.a.createElement(r.a.Fragment,{},t)}},u=r.a.forwardRef((function(e,t){var a=e.components,n=e.mdxType,i=e.originalType,o=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),c=p(a),u=n,m=c["".concat(o,".").concat(u)]||c[u]||b[u]||i;return a?r.a.createElement(m,l(l({ref:t},d),{},{components:a})):r.a.createElement(m,l({ref:t},d))}));function m(e,t){var a=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=a.length,o=new Array(i);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:n,o[1]=l;for(var d=2;d<i;d++)o[d]=a[d];return r.a.createElement.apply(null,o)}return r.a.createElement.apply(null,a)}u.displayName="MDXCreateElement"}}]);
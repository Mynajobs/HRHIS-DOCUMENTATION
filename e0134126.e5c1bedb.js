(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{106:function(e,n,t){"use strict";t.r(n),t.d(n,"frontMatter",(function(){return s})),t.d(n,"metadata",(function(){return o})),t.d(n,"toc",(function(){return l})),t.d(n,"default",(function(){return d}));var a=t(3),i=t(7),r=(t(0),t(114)),s={id:"analytics",title:"Analytics",sidebar_label:"Analytics"},o={unversionedId:"developers/data/analytics",id:"developers/data/analytics",isDocsHomePage:!1,title:"Analytics",description:"Analytics",source:"@site/docs/developers/data/analytics.md",slug:"/developers/data/analytics",permalink:"/hris-api-docs/docs/developers/data/analytics",editUrl:"https://github.com/udsm-dhis2-project/hris-api-docs/blob/main/docs/developers/data/analytics.md",version:"current",sidebar_label:"Analytics",sidebar:"docs",previous:{title:"Records Module",permalink:"/hris-api-docs/docs/developers/data/records"},next:{title:"dashboards",permalink:"/hris-api-docs/docs/developers/data/dashboards"}},l=[{value:"Analytics",id:"analytics",children:[{value:"Request query parameters",id:"request-query-parameters",children:[]},{value:"Dimensions and items",id:"dimensions-and-items",children:[]},{value:"The dx dimension",id:"the-dx-dimension",children:[]},{value:"Response formats",id:"response-formats",children:[]},{value:"Constraints and validation",id:"constraints-and-validation",children:[]},{value:"Data value set format",id:"data-value-set-format",children:[]},{value:"Raw data format",id:"raw-data-format",children:[]},{value:"Debugging",id:"debugging",children:[]}]},{value:"Event analytics",id:"event-analytics",children:[{value:"Dimensions and items",id:"dimensions-and-items-1",children:[]},{value:"Request query parameters",id:"request-query-parameters-1",children:[]},{value:"Event query analytics",id:"event-query-analytics",children:[]},{value:"Event aggregate analytics",id:"event-aggregate-analytics",children:[]},{value:"Event clustering analytics",id:"event-clustering-analytics",children:[]},{value:"Event count and extent analytics",id:"event-count-and-extent-analytics",children:[]},{value:"Constraints and validation",id:"constraints-and-validation-1",children:[]}]},{value:"Enrollment analytics",id:"enrollment-analytics",children:[{value:"Dimensions and items",id:"dimensions-and-items-2",children:[]},{value:"Enrollment query analytics",id:"enrollment-query-analytics",children:[]},{value:"Request query parameters",id:"request-query-parameters-2",children:[]},{value:"Support of analytics across tracked entity instance relationships with program indicators",id:"support-of-analytics-across-tracked-entity-instance-relationships-with-program-indicators",children:[]}]},{value:"Org unit analytics",id:"org-unit-analytics",children:[{value:"Request query parameters",id:"request-query-parameters-3",children:[]},{value:"Response formats",id:"response-formats-4",children:[]},{value:"Examples",id:"examples",children:[]}]},{value:"Data set report",id:"data-set-report",children:[{value:"Request query parameters",id:"request-query-parameters-4",children:[]},{value:"Response formats",id:"response-formats-5",children:[]},{value:"Custom forms",id:"custom-forms",children:[]}]},{value:"Data usage analytics",id:"data-usage-analytics",children:[{value:"Request query parameters",id:"request-query-parameters-5",children:[]},{value:"Create view events (POST)",id:"create-view-events-post",children:[]},{value:"Retrieve aggregated usage analytics report (GET)",id:"retrieve-aggregated-usage-analytics-report-get",children:[]},{value:"Retrieve top favorites",id:"retrieve-top-favorites",children:[]},{value:"Response format",id:"response-format",children:[]},{value:"Retrieve statistics for a favorite",id:"retrieve-statistics-for-a-favorite",children:[]}]},{value:"Geospatial features",id:"geospatial-features",children:[{value:"GeoJSON",id:"geojson",children:[]}]},{value:"Generating resource and analytics tables",id:"generating-resource-and-analytics-tables",children:[]}],p={toc:l};function d(e){var n=e.components,t=Object(i.a)(e,["components"]);return Object(r.b)("wrapper",Object(a.a)({},p,t,{components:n,mdxType:"MDXLayout"}),Object(r.b)("h2",{id:"analytics"},"Analytics"),Object(r.b)("p",null,"To access analytical, aggregated data in HRHIS4 you can work with the\n",Object(r.b)("em",{parentName:"p"},"analytics")," resource. The analytics resource is powerful as it lets you\nquery and retrieve data aggregated along all available data dimensions.\nFor instance, you can ask the analytics resource to provide the\naggregated data values for a set of data elements, periods and\norganisation units. Also, you can retrieve the aggregated data for a\ncombination of any number of dimensions based on data elements and\norganisation unit group sets."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics\n")),Object(r.b)("h3",{id:"request-query-parameters"},"Request query parameters"),Object(r.b)("p",null,"The analytics resource lets you specify a range of query parameters:"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"dimension")," query parameter defines which dimensions should be\nincluded in the analytics query. Any number of dimensions can be\nspecified. The dimension parameter should be repeated for each dimension\nto include in the query response. The query response can potentially\ncontain aggregated values for all combinations of the specified\ndimension items."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"filter")," parameter defines which dimensions should be used as\nfilters for the data retrieved in the analytics query. Any number of\nfilters can be specified. The filter parameter should be repeated for\neach filter to use in the query. A filter differs from a dimension in\nthat the filter dimensions will not be part of the query response\ncontent, and that the aggregated values in the response will be\ncollapsed on the filter dimensions. In other words, the data in the\nresponse will be aggregated on the filter dimensions, but the filters\nwill not be included as dimensions in the actual response. As an\nexample, to query for certain data elements filtered by the periods and\norganisation units you can use the following URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&filter=pe:2014Q1;2014Q2\n  &filter=ou:O6uvpzGd5pu;lc3eMKXaEfw\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"aggregationType"),' query parameter lets you define which aggregation\noperator should be used for the query. By default, the aggregation\noperator defined for data elements included in the query will be used.\nIf your query does not contain any data elements but does include data\nelement groups, the aggregation operator of the first data element in\nthe first group will be used. The order of groups and data elements is\nundefined. This query parameter allows you to override the default and\nspecify a specific aggregation operator. As an example, you can set the\naggregation operator to "count" with the following URL:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD&dimension=pe:2014Q1&dimension=ou:O6uvpzGd5pu\n  &aggregationType=COUNT\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"measureCriteria")," query parameter lets you filter out ranges of data\nrecords to return. You can instruct the system to return only records\nwhere the aggregated data value is equal, greater than, greater or\nequal, less than or less or equal to certain values. You can specify any\nnumber of criteria on the following format, where ",Object(r.b)("em",{parentName:"p"},"criteria")," and\n",Object(r.b)("em",{parentName:"p"},"value")," should be substituted with real values:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?measureCriteria=criteria:value;criteria:value\n")),Object(r.b)("p",null,"As an example, the following query will return only records where the\ndata value is greater or equal to 6500 and less than 33000:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&dimension=pe:2014\n  &dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw&measureCriteria=GE:6500;LT:33000\n")),Object(r.b)("p",null,"Similar to ",Object(r.b)("em",{parentName:"p"},"measureCriteria"),", the ",Object(r.b)("em",{parentName:"p"},"preAggregationMeasureCriteria")," query\nparameter lets you filter out data, only before aggregation is\nperformed. For example, the following query only aggregates data where\nthe original value is within the criteria defined:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&dimension=pe:2014\n  &dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw&preAggregationMeasureCriteria=GE:10;LT:100\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"startDate")," and ",Object(r.b)("em",{parentName:"p"},"endDate")," parameters can be used to specify a custom\ndate range to aggregate over. When specifying a date range you can not\nspecify relative nor fixed periods as dimension or filter. The date range\nwill filter the analytics response. You can use it like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.json?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &dimension=ou:ImspTQPwCqd&startDate=2018-01-01&endDate=2018-06-01\n")),Object(r.b)("p",null,"In order to have the analytics resource generate the data in the shape\nof a ready-made table, you can provide the ",Object(r.b)("em",{parentName:"p"},"tableLayout")," parameter with\ntrue as value. Instead of generating a plain, normalized data source,\nthe analytics resource will now generate the data in a table layout. You\ncan use the ",Object(r.b)("em",{parentName:"p"},"columns")," and ",Object(r.b)("em",{parentName:"p"},"rows")," parameters with dimension identifiers\nseparated by semi-colons as values to indicate which ones to use as\ntable columns and rows. The column and rows dimensions must be present\nas a data dimension in the query (not a filter). Such a request can look\nlike this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.html?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU&dimension=pe:2014Q1;2014Q2\n  &dimension=ou:O6uvpzGd5pu&tableLayout=true&columns=dx;ou&rows=pe\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"order")," parameter can be used for analytics resource to generate\nordered data. The data will be ordered in ascending (or descending) order\nof values. An example request for ordering the values in descending\norder is:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD&dimension=pe:LAST_12_MONTHS\n  &dimension=ou:O6uvpzGd5pu&order=DESC\n")),Object(r.b)("h3",{id:"dimensions-and-items"},"Dimensions and items"),Object(r.b)("p",null,"HRHIS4 features a multi-dimensional data model with several fixed and\ndynamic data dimensions. The fixed dimensions are the data element,\nperiod (time) and organisation unit dimension. You can dynamically add\ndimensions through categories, data element group sets and organisation\nunit group sets. The table below displays the available data dimensions\nin HRHIS4. Each data dimension has a corresponding ",Object(r.b)("em",{parentName:"p"},"dimension\nidentifier"),", and each dimension can have a set of ",Object(r.b)("em",{parentName:"p"},"dimension items"),":"),Object(r.b)("p",null,"It is not necessary to be aware of which objects are used for the\nvarious dynamic dimensions when designing analytics queries. You can get\na complete list of dynamic dimensions by visiting this URL in the Web API:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dimensions\n")),Object(r.b)("p",null,"The base URL to the analytics resource is ",Object(r.b)("inlineCode",{parentName:"p"},"/api/analytics"),". To request\nspecific dimensions and dimension items you can use a query string on\nthe following format, where ",Object(r.b)("inlineCode",{parentName:"p"},"dim-id")," and ",Object(r.b)("inlineCode",{parentName:"p"},"dim-item")," should be substituted with real values:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dim-id:dim-item;dim-item&dimension=dim-id:dim-item;dim-item\n")),Object(r.b)("p",null,"As illustrated above, the dimension identifier is followed by a colon\nwhile the dimension items are separated by semi-colons. As an example, a\nquery for two data elements, two periods and two organisation units can\nbe done with the following URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &dimension=pe:2016Q1;2016Q2&dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw\n")),Object(r.b)("p",null,"To query for data broken down by category option combinations instead of\ndata element totals you can include the category dimension in the query\nstring, for instance like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &dimension=co&dimension=pe:201601&dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw\n")),Object(r.b)("p",null,"When selecting data elements you can also select all data elements in a\ngroup as items by using the DE_GROUP-groupid syntax:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:DE_GROUP-h9cuJOkOwY2\n  &dimension=pe:201601&dimension=ou:O6uvpzGd5pu\n")),Object(r.b)("p",null,"When selecting data set reporting rates, the syntax contains a data\nset identifier followed by a reporting rate metric:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:BfMAe6Itzgt.REPORTING_RATE;BfMAe6Itzgt.ACTUAL_REPORTS\n  &dimension=pe:201601&dimension=ou:O6uvpzGd5pu\n")),Object(r.b)("p",null,"To query for organisation unit group sets and data elements you can use\nthe following URL. Notice how the group set identifier is used as\na dimension identifier and the groups as dimension items:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=Bpx0589u8y0:oRVt7g429ZO;MAs88nJc9nL\n  &dimension=pe:2016&dimension=ou:ImspTQPwCqd\n")),Object(r.b)("p",null,"To query for data elements and categories you can use this URL. Use the\ncategory identifier as a dimension identifier and the category options as\ndimension items:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:s46m5MS0hxu;fClA2Erf6IO&dimension=pe:2016\n  &dimension=YNZyaJHiHYq:btOyqprQ9e8;GEqzEKCHoGA&filter=ou:ImspTQPwCqd\n")),Object(r.b)("p",null,"To query using relative periods and organisation units associated with\nthe current user you can use a URL like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &dimension=pe:LAST_12_MONTHS&dimension=ou:USER_ORGUNIT\n")),Object(r.b)("p",null,"When selecting organisation units for a dimension you can select an\nentire level optionally constrained by any number of boundary\norganisation units with the ",Object(r.b)("inlineCode",{parentName:"p"},"LEVEL-<level>")," syntax. Boundary refers to a\ntop node in a sub-hierarchy, meaning that all organisation units at the\ngiven level below the given boundary organisation unit in the hierarchy\nwill be included in the response, and is provided as regular organisation unit\ndimension items. The level value can either be a numerical level or refer to the identifier\nof the organisation unit level entity. A simple query for all org units at level three:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD&dimension=pe:2016&dimension=ou:LEVEL-3\n")),Object(r.b)("p",null,"A query for level three and four with two boundary org units can be\nspecified like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD&dimension=pe:2016\n  &dimension=ou:LEVEL-3;LEVEL-4;O6uvpzGd5pu;lc3eMKXaEf\n")),Object(r.b)("p",null,"When selecting organisation units you can also select all organisation\nunits in an organisation unit group to be included as dimension items\nusing the OU_GROUP-groupid syntax. The organisation units in the groups\ncan optionally be constrained by any number of boundary organisation\nunits. Both the level and the group items can be repeated any number of\ntimes:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD&dimension=pe:2016\n  &dimension=ou:OU_GROUP-w0gFTTmsUcF;OU_GROUP-EYbopBOJWsW;O6uvpzGd5pu;lc3eMKXaEf\n")),Object(r.b)("p",null,"You can utilize identifier schemes for the metadata part of the\nanalytics response with the outputIdScheme property like this. You can\nuse ID, code and attributes as identifier scheme:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &dimension=pe:2017Q1;2017Q2&dimension=ou:O6uvpzGd5pu&outputIdScheme=CODE\n")),Object(r.b)("p",null,"A few things to be aware of when using the analytics resource are listed\nbelow."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},'Data elements, indicator, data set reporting rates, program data\nelements and program indicators are part of a common data dimension,\nidentified as "dx". This means that you can use any of data\nelements, indicators and data set identifiers together with the "dx"\ndimension identifier in a query.')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"For the category, data element group set and organisation unit group\nset dimensions, all dimension items will be used in the query if no\ndimension items are specified.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},'For the period dimension, the dimension items are ISO period\nidentifiers and/or relative periods. Please refer to the section\nabove called "Date and period format" for the period format and\navailable relative periods.')),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"For the organisation unit dimension, you can specify the items to be\nthe organisation unit or sub-units of the organisation unit\nassociated with the user currently authenticated for the request\nusing the keys ",Object(r.b)("inlineCode",{parentName:"p"},"USER_ORGUNIT")," or ",Object(r.b)("inlineCode",{parentName:"p"},"USER_ORGUNIT_CHILDREN")," as items,\nrespectively. You can also specify organisation unit identifiers\ndirectly, or a combination of both.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"For the organisation unit dimension, you can specify the organisation\nhierarchy level and the boundary unit to use for the request on the\nformat ",Object(r.b)("inlineCode",{parentName:"p"},"LEVEL-<level>-<boundary-id>"),"; as an example\n",Object(r.b)("inlineCode",{parentName:"p"},"LEVEL-3-ImspTQPwCqd")," implies all organisation units below the given\nboundary unit at level 3 in the hierarchy.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"For the organisation unit dimension, the dimension items are the\norganisation units and their sub-hierarchy - data will be aggregated\nfor all organisation units below the given organisation unit in the\nhierarchy.")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"You cannot specify dimension items for the category option\ncombination dimension. Instead, the response will contain the items\nwhich are linked to the data values."))),Object(r.b)("h3",{id:"the-dx-dimension"},"The dx dimension"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"dx")," dimension is a special dimension which can contain all of the\nfollowing data types."),Object(r.b)("p",null,"Items from all of the various ",Object(r.b)("inlineCode",{parentName:"p"},"dx")," types can be combined in an analytics\nrequest. An example looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.json\n  ?dimension=dx:Uvn6LCg7dVU;BfMAe6Itzgt.REPORTING_RATE;IpHINAT79UW.a3kGcGDCuk6\n  &dimension=pe:LAST_12_MONTHS&filter=ou:ImspTQPwCqd\n")),Object(r.b)("p",null,"The group syntax can be used together with any other item as well. An\nexample looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.json\n  ?dimension=dx:DE_GROUP-qfxEYY9xAl6;IN_GROUP-oehv9EO3vP7;BfMAe6Itzgt.REPORTING_RATE\n  &dimension=pe:LAST_12_MONTHS&filter=ou:ImspTQPwCqd\n")),Object(r.b)("p",null,"Data element operands can optionally specify attribute option\ncombinations and use wildcards e.g. to specify all category option\ncombination values:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.json\n  ?dimension=dx:Uvn6LCg7dVU.*.j8vBiBqGf6O;Uvn6LCg7dVU.Z4oQs46iTeR\n  &dimension=pe:LAST_12_MONTHS&filter=ou:ImspTQPwCqd\n")),Object(r.b)("blockquote",null,Object(r.b)("p",{parentName:"blockquote"},Object(r.b)("strong",{parentName:"p"},"Tip")),Object(r.b)("p",{parentName:"blockquote"},"A great way to learn how to use the analytics API is to use the HRHIS4\n",Object(r.b)("em",{parentName:"p"},"pivot table")," app. You can play around with pivot tables using the\nvarious dimensions and items and click Download > Plain data source > JSON\nto see the resulting analytics API calls in the address bar of\nyour Web browser.")),Object(r.b)("h3",{id:"response-formats"},"Response formats"),Object(r.b)("p",null,"The analytics response containing aggregate data can be returned in\nvarious representation formats. As usual, you can indicate interest in a\nspecific format by appending a file extension to the URL, through the\n",Object(r.b)("inlineCode",{parentName:"p"},"Accept")," HTTP header or through the ",Object(r.b)("inlineCode",{parentName:"p"},"format")," query parameter. The\ndefault format is JSON. The available formats and content-types are\nlisted below."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"json (application/json)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"jsonp (application/javascript)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"xml (application/xml)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"csv (application/csv)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"html (text/html)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"html+css (text/html)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"xls (application/vnd.ms-excel)"))),Object(r.b)("p",null,"As an example, to request an analytics response in XML format you can\nuse the following URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.xml?dimension=dx:fbfJHSPpUQD\n  &dimension=pe:2016&dimension=ou:O6uvpzGd5pu;lc3eMKXaEfw\n")),Object(r.b)("p",null,"The analytics responses must be retrieved using the HTTP ",Object(r.b)("em",{parentName:"p"},"GET")," method.\nThis allows for direct linking to analytics responses from Web pages as\nwell as other HTTP-enabled clients. To do functional testing we can use\nthe cURL library. By executing this command against the demo database\nyou will get an analytics response in JSON format:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},'curl "dev.hrhis.dhis2udsm.org/demo/api/analytics.json?dimension=dx:eTDtyyaSA7f;FbKK4ofIv5R\n  &dimension=pe:2016Q1;2016Q2&filter=ou:ImspTQPwCqd" -u admin:district\n')),Object(r.b)("p",null,"The JSON response will look like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "headers": [\n    {\n      "name": "dx",\n      "column": "Data",\n      "meta": true,\n      "type": "java.lang.String"\n    },\n    {\n      "name": "pe",\n      "column": "Period",\n      "meta": true,\n      "type": "java.lang.String"\n    },\n    {\n      "name": "value",\n      "column": "Value",\n      "meta": false,\n      "type": "java.lang.Double"\n    }\n  ],\n  "height": 4,\n  "metaData": {\n    "pe": [\n      "2016Q1",\n      "2016Q2"\n    ],\n    "ou": [\n      "ImspTQPwCqd"\n    ],\n    "names": {\n      "2016Q1": "Jan to Mar 2016",\n      "2016Q2": "Apr to Jun 2016",\n      "FbKK4ofIv5R": "Measles Coverage <1 y",\n      "ImspTQPwCqd": "Sierra Leone",\n      "eTDtyyaSA7f": "Fully Immunized Coverage"\n    }\n  },\n  "rows": [\n    [\n      "eTDtyyaSA7f",\n      "2016Q2",\n      "81.1"\n    ],\n    [\n      "eTDtyyaSA7f",\n      "2016Q1",\n      "74.7"\n    ],\n    [\n      "FbKK4ofIv5R",\n      "2016Q2",\n      "88.9"\n    ],\n    [\n      "FbKK4ofIv5R",\n      "2016Q1",\n      "84.0"\n    ]\n  ],\n  "width": 3\n}\n')),Object(r.b)("p",null,"The response represents a table of dimensional data. The ",Object(r.b)("em",{parentName:"p"},"headers")," array\ngives an overview of which columns are included in the table and what\nthe columns contain. The ",Object(r.b)("em",{parentName:"p"},"column"),' property shows the column dimension\nidentifier, or if the column contains measures, the word "Value". The\n',Object(r.b)("em",{parentName:"p"},"meta")," property is ",Object(r.b)("em",{parentName:"p"},"true")," if the column contains dimension items or\n",Object(r.b)("em",{parentName:"p"},"false")," if the column contains a measure (aggregated data values). The\n",Object(r.b)("em",{parentName:"p"},"name"),' property is similar to the column property, except it displays\n"value" in case the column contains a measure. The ',Object(r.b)("em",{parentName:"p"},"type")," property\nindicates the Java class type of column values."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"height")," and ",Object(r.b)("em",{parentName:"p"},"width")," properties indicate how many data columns and\nrows are contained in the response, respectively."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"metaData periods")," property contains a unique, ordered array of the\nperiods included in the response. The ",Object(r.b)("em",{parentName:"p"},"metaData ou")," property contains an\narray of the identifiers of organisation units included in the response.\nThe ",Object(r.b)("em",{parentName:"p"},"metaData names")," property contains a mapping between the identifiers\nused in the data response and the names of the objects they represent.\nIt can be used by clients to substitute the identifiers within the data\nresponse with names in order to give a more meaningful view of the data\ntable."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"rows")," array contains the dimensional data table. It contains\ncolumns with dimension items (object or period identifiers) and a column\nwith aggregated data values. The example response above has a\ndata/indicator column, a period column and a value column. The first\ncolumn contains indicator identifiers, the second contains ISO period\nidentifiers and the third contains aggregated data values."),Object(r.b)("h3",{id:"constraints-and-validation"},"Constraints and validation"),Object(r.b)("p",null,"There are several constraints to the input parameters you can provide to the\nanalytics resource. If any of the constraints are violated, the API will\nreturn a ",Object(r.b)("em",{parentName:"p"},"409 Conflict")," response and a response message looking similar to this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "httpStatus": "Conflict",\n  "httpStatusCode": 409,\n  "status": "ERROR",\n  "message": "Only a single indicator can be specified as filter",\n  "errorCode": "E7108"\n}\n')),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"httpStatus")," and ",Object(r.b)("inlineCode",{parentName:"p"},"httpStatusCode")," fields indicate the HTTP status and\nstatus code per the HTTP specification. The ",Object(r.b)("inlineCode",{parentName:"p"},"messsage")," field provides a\nhuman-readable description of the validation error. The ",Object(r.b)("inlineCode",{parentName:"p"},"errorCode")," field\nprovides a machine-readable code which can be used by clients to handle\nvalidation errors. The possible validation errors for the aggregate analytics\nAPI are described in the table below."),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Error code"),Object(r.b)("th",{parentName:"tr",align:null},"Message"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7100"),Object(r.b)("td",{parentName:"tr",align:null},"Query parameters cannot be null")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7101"),Object(r.b)("td",{parentName:"tr",align:null},"At least one dimension must be specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7102"),Object(r.b)("td",{parentName:"tr",align:null},"At least one data dimension item or data element group set dimension item must be specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7103"),Object(r.b)("td",{parentName:"tr",align:null},"Dimensions cannot be specified as dimension and filter simultaneously")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7104"),Object(r.b)("td",{parentName:"tr",align:null},"At least one period as dimension or filter, or start and dates, must be specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7105"),Object(r.b)("td",{parentName:"tr",align:null},"Periods and start and end dates cannot be specified simultaneously")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7106"),Object(r.b)("td",{parentName:"tr",align:null},"Start date cannot be after end date")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7107"),Object(r.b)("td",{parentName:"tr",align:null},"Start and end dates cannot be specified for reporting rates")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7108"),Object(r.b)("td",{parentName:"tr",align:null},"Only a single indicator can be specified as filter")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7109"),Object(r.b)("td",{parentName:"tr",align:null},"Only a single reporting rate can be specified as filter")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7110"),Object(r.b)("td",{parentName:"tr",align:null},"Category option combos cannot be specified as filter")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7111"),Object(r.b)("td",{parentName:"tr",align:null},"Dimensions cannot be specified more than once")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7112"),Object(r.b)("td",{parentName:"tr",align:null},"Reporting rates can only be specified together with dimensions of type")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7113"),Object(r.b)("td",{parentName:"tr",align:null},"Assigned categories cannot be specified when data elements are not specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7114"),Object(r.b)("td",{parentName:"tr",align:null},"Assigned categories can only be specified together with data elements, not indicators or reporting rates")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7115"),Object(r.b)("td",{parentName:"tr",align:null},"Data elements must be of a value and aggregation type that allow aggregation")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7116"),Object(r.b)("td",{parentName:"tr",align:null},"Indicator expressions cannot contain cyclic references")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7117"),Object(r.b)("td",{parentName:"tr",align:null},"A data dimension 'dx' must be specified when output format is DATA_VALUE_SET")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7118"),Object(r.b)("td",{parentName:"tr",align:null},"A period dimension 'pe' must be specified when output format is DATA_VALUE_SET")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7119"),Object(r.b)("td",{parentName:"tr",align:null},"An organisation unit dimension 'ou' must be specified when output format is DATA_VALUE_SET")))),Object(r.b)("h3",{id:"data-value-set-format"},"Data value set format"),Object(r.b)("p",null,"The analytics ",Object(r.b)("em",{parentName:"p"},"dataValueSet")," resource allows for returning aggregated\ndata in the data value set format. This format represents raw data\nvalues, as opposed to data which has been aggregated along various\ndimensions. Exporting aggregated data as regular data values is useful\nfor data exchange between systems when the target system contains data\nof finer granularity compared to what the destination system is storing."),Object(r.b)("p",null,"As an example, one can specify an indicator in the target system to\nsummarize data for multiple data elements and import this data for a\nsingle data element in the destination system. As another example, one\ncan aggregate data collected at organisation unit level 4 in the target\nsystem to level 2 and import that data in the destination system."),Object(r.b)("p",null,"You can retrieve data in the raw data value set format from the\ndataValueSet resource:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/dataValueSet\n")),Object(r.b)("p",null,"The following resource representations are supported:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"json (application/json)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"xml (application/xml)"))),Object(r.b)("p",null,"When using the data value set format, exactly three dimensions must be\nspecified as analytics dimensions with at least one dimension item each:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Data (dx)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Period (pe)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"Organisation unit (ou)"))),Object(r.b)("p",null,"Any other dimension will be ignored. Filters will be applied as with\nregular analytics requests. Note that any data dimension type can be\nspecified, including indicators, data elements, data element operands,\ndata sets and program indicators."),Object(r.b)("p",null,"An example request which aggregates data for specific indicators,\nperiods and organisation units and returns it as regular data values in\nXML looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"api/analytics/dataValueSet.xml?dimension=dx:Uvn6LCg7dVU;OdiHJayrsKo\n  &dimension=pe:LAST_4_QUARTERS&dimension=ou:lc3eMKXaEfw;PMa2VCrupOd\n")),Object(r.b)("p",null,"A request which aggregates data for data element operands and uses CODE\nas output identifier scheme looks like the below. When defining the\noutput identifier scheme, all metadata objects part of the response are\naffected:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"api/analytics/dataValueSet.json?dimension=dx:fbfJHSPpUQD.pq2XI5kz2BY;fbfJHSPpUQD.PT59n8BQbqM\n  &dimension=pe:LAST_12_MONTHS&dimension=ou:ImspTQPwCqd&outputIdScheme=CODE\n")),Object(r.b)("p",null,"When using attribute-based identifier schemes for export there is a risk\nof producing duplicate data values. The boolean query parameter\nduplicatesOnly can be used for debugging purposes to return only\nduplicates data values. This response can be used to clean up the\nduplicates:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"api/analytics/dataValueSet.xml?dimension=dx:Uvn6LCg7dVU;OdiHJayrsKo\n  &dimension=pe:LAST_4_QUARTERS&dimension=ou:lc3eMKXaEfw&duplicatesOnly=true\n")),Object(r.b)("h3",{id:"raw-data-format"},"Raw data format"),Object(r.b)("p",null,"The analytics ",Object(r.b)("em",{parentName:"p"},"rawData")," resource allows for returning the data stored in\nthe analytics data tables without any aggregation being performed. This\nis useful for clients which would like to perform aggregation and\nfiltering on their own without having to denormalize data in the\navailable data dimensions themselves."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/rawData\n")),Object(r.b)("p",null,"The following resource representations are supported:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"json (application/json)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"csv (application/csv)"))),Object(r.b)("p",null,"This resource follows the syntax of the regular analytics resource. Only\na subset of the query parameters are supported. Additionally, a\n",Object(r.b)("em",{parentName:"p"},"startDate")," and ",Object(r.b)("em",{parentName:"p"},"endDate")," parameter are available. The supported\nparameters are listed in the table below."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"dimension")," query parameter defines which dimensions (table columns)\nshould be included in the response. It can optionally be constrained\nwith items. The ",Object(r.b)("em",{parentName:"p"},"filter")," query parameter defines which items and\ndimensions (table columns) should be used as a filter for the response."),Object(r.b)("p",null,"For the organisation unit dimension, the response will contain data\nassociated with the organisation unit and all organisation units in the\nsub-hierarchy (children in the tree). This is different compared to the\nregular analytics resource, where only the explicitly selected\norganisation units are included."),Object(r.b)("p",null,"To retrieve a response with specific data elements, specific periods,\nspecific organisation units and all data for two custom dimensions you\ncan issue a request like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/rawData.json?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU;Jtf34kNZhzP\n  &dimension=J5jldMd8OHv&dimension=Bpx0589u8y0\n  &dimension=pe:LAST_12_MONTHS\n  &dimension=ou:O6uvpzGd5pu;fdc6uOvgoji\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"startDate")," and ",Object(r.b)("em",{parentName:"p"},"endDate")," parameters allow for fetching data linked\nto any period between those dates. This avoids the need for defining all\nperiods explicitly in the\nrequest:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/rawData.json?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU;Jtf34kNZhzP\n  &dimension=J5jldMd8OHv&dimension=Bpx0589u8y0\n  &startDate=2015-01-01&endDate=2015-12-31\n  &dimension=ou:O6uvpzGd5pu;fdc6uOvgoji\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"filter")," parameter can be used to filter a response without\nincluding that dimension as part of the response, this time in CSV\nformat:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/rawData.csv?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU;Jtf34kNZhzP\n  &filter=J5jldMd8OHv:uYxK4wmcPqA;tDZVQ1WtwpA\n  &startDate=2015-01-01&endDate=2015-12-31\n  &dimension=ou:O6uvpzGd5pu\n")),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"outputIdScheme")," parameter is useful if you want human readable data\nresponses as it can be set to ",Object(r.b)("em",{parentName:"p"},"NAME")," like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/rawData.csv?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &filter=J5jldMd8OHv:uYxK4wmcPqA;tDZVQ1WtwpA\n  &startDate=2017-01-01&endDate=2017-12-31\n  &dimension=ou:O6uvpzGd5pu\n  &outputIdScheme=NAME\n")),Object(r.b)("p",null,"The response from the ",Object(r.b)("em",{parentName:"p"},"rawData")," resource will look identical to the\nregular analytics resource; the difference is that the response contains\nraw, non-aggregated data, suitable for further aggregation by\nthird-party systems."),Object(r.b)("h3",{id:"debugging"},"Debugging"),Object(r.b)("p",null,"When debugging analytics requests it can be useful to examine the data\nvalue source of the aggregated analytics response. The\n",Object(r.b)("em",{parentName:"p"},"analytics/debug/sql"),' resource will provide an SQL statement that\nreturns the relevant content of the datavalue table. You can produce\nthis SQL by doing a GET request with content type "text/html" or\n"text/plain" like below. The dimension and filter syntax are identical to\nregular analytics queries:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/debug/sql?dimension=dx:fbfJHSPpUQD;cYeuwXTCPkU\n  &filter=pe:2016Q1;2016Q2&filter=ou:O6uvpzGd5pu\n")),Object(r.b)("h2",{id:"event-analytics"},"Event analytics"),Object(r.b)("p",null,"The event analytics API lets you access aggregated event data and query\n",Object(r.b)("em",{parentName:"p"},"events")," captured in HRHIS4. This resource lets you retrieve events based\non a program and optionally a program stage, and lets you retrieve and\nfilter events on any event dimensions."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events\n")),Object(r.b)("h3",{id:"dimensions-and-items-1"},"Dimensions and items"),Object(r.b)("p",null,"Event dimensions include data elements, attributes, organisation units\nand periods. The aggregated event analytics resource will return\naggregated information such as counts or averages. The query analytics\nresource will simply return events matching a set of criteria and does\nnot perform any aggregation. You can specify dimension items in the form\nof options from option sets and legends from legend sets for data\nelements and attributes which are associated with such. The event\ndimensions are listed in the table below."),Object(r.b)("h3",{id:"request-query-parameters-1"},"Request query parameters"),Object(r.b)("p",null,"The analytics event API lets you specify a range of query parameters."),Object(r.b)("h3",{id:"event-query-analytics"},"Event query analytics"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"analytics/events/query")," resource lets you query for captured\nevents. This resource does not perform any aggregation, rather it lets\nyou query and filter for information about events."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query\n")),Object(r.b)("p",null,"You can specify any number of dimensions and any number of filters in a\nquery. Dimension item identifiers can refer to any of data elements,\nperson attributes, person identifiers, fixed and relative periods and\norganisation units. Dimensions can optionally have a query operator and\na filter. Event queries should be on the format described\nbelow."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/<program-id>?startDate=yyyy-MM-dd&endDate=yyyy-MM-dd\n  &dimension=ou:<ou-id>;<ou-id>&dimension=<item-id>&dimension=<item-id>:<operator>:<filter>\n")),Object(r.b)("p",null,'For example, to retrieve events from the "Inpatient morbidity and\nmortality" program between January and October 2016, where the "Gender"\nand "Age" data elements are included and the "Age" dimension is filtered\non "18", you can use the following\nquery:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:O6uvpzGd5pu;fdc6uOvgoji&dimension=oZg33kd9taw&dimension=qrur9Dvnyt5:EQ:18\n")),Object(r.b)("p",null,'To retrieve events for the "Birth" program stage of the "Child\nprogramme" program between March and December 2016, where the "Weight"\ndata element, filtered for values larger than\n2000:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/IpHINAT79UW?stage=A03MvHHogjR&startDate=2016-03-01\n  &endDate=2016-12-31&dimension=ou:O6uvpzGd5pu&dimension=UXz7xuGCEhU:GT:2000\n")),Object(r.b)("p",null,'Sorting can be applied to the query for the event date of the event and\nany dimensions. To sort descending on the event date and ascending on\nthe "Age" data element dimension you can\nuse:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:O6uvpzGd5pu&dimension=qrur9Dvnyt5&desc=EVENTDATE&asc=qrur9Dvnyt5\n")),Object(r.b)("p",null,"Paging can be applied to the query by specifying the page number and the\npage size parameters. If page number is specified but page size is not,\na page size of 50 will be used. If page size is specified but page\nnumber is not, a page number of 1 will be used. To get the third page of\nthe response with a page size of 20 you can use a query like\nthis:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:O6uvpzGd5pu&dimension=qrur9Dvnyt5&page=3&pageSize=20\n")),Object(r.b)("h4",{id:"filtering"},"Filtering"),Object(r.b)("p",null,"Filters can be applied to data elements, person attributes and person\nidentifiers. The filtering is done through the query parameter value on\nthe following format:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=<item-id>:<operator>:<filter-value>\n")),Object(r.b)("p",null,'As an example, you can filter the "Weight" data element for values\ngreater than 2000 and lower than 4000 like this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=UXz7xuGCEhU:GT:2000&dimension=UXz7xuGCEhU:LT:4000\n")),Object(r.b)("p",null,'You can filter the "Age" data element for multiple, specific ages using\nthe IN operator like this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=qrur9Dvnyt5:IN:18;19;20\n")),Object(r.b)("p",null,"You can specify multiple filters for a given item by repeating the\noperator and filter components, all separated with semi-colons:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=qrur9Dvnyt5:GT:5:LT:15\n")),Object(r.b)("p",null,"The available operators are listed below."),Object(r.b)("h4",{id:"response-formats-1"},"Response formats"),Object(r.b)("p",null,"The default response representation format is JSON. The requests must be\nusing the HTTP ",Object(r.b)("em",{parentName:"p"},"GET")," method. The following response formats are\nsupported."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"json (application/json)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"jsonp (application/javascript)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"xls (application/vnd.ms-excel)"))),Object(r.b)("p",null,"As an example, to get a response in Excel format you can use a file\nextension in the request URL like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/eBAyeGv0exc.xls?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:O6uvpzGd5pu&dimension=oZg33kd9taw&dimension=qrur9Dvnyt5\n")),Object(r.b)("p",null,"You can set the hierarchyMeta query parameter to true in order to\ninclude names of all ancestor organisation units in the meta-section of\nthe response:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/query/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:YuQRtpLP10I&dimension=qrur9Dvnyt5:EQ:50&hierarchyMeta=true\n")),Object(r.b)("p",null,"The default response JSON format will look similar to this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "headers": [\n    {\n      "name": "psi",\n      "column": "Event",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "ps",\n      "column": "Program stage",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "eventdate",\n      "column": "Event date",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "coordinates",\n      "column": "Coordinates",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "ouname",\n      "column": "Organisation unit name",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "oucode",\n      "column": "Organisation unit code",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "ou",\n      "column": "Organisation unit",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "oZg33kd9taw",\n      "column": "Gender",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    },\n    {\n      "name": "qrur9Dvnyt5",\n      "column": "Age",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": false\n    }\n  ],\n  "metaData": {\n    "names": {\n      "qrur9Dvnyt5": "Age",\n      "eBAyeGv0exc": "Inpatient morbidity and mortality",\n      "ImspTQPwCqd": "Sierra Leone",\n      "O6uvpzGd5pu": "Bo",\n      "YuQRtpLP10I": "Badjia",\n      "oZg33kd9taw": "Gender"\n    },\n    "ouHierarchy": {\n      "YuQRtpLP10I": "/ImspTQPwCqd/O6uvpzGd5pu"\n    }\n  },\n  "width": 8,\n  "height": 4,\n  "rows": [\n    [\n      "yx9IDINf82o",\n      "Zj7UnCAulEk",\n      "2016-08-05",\n      "[5.12, 1.23]",\n      "Ngelehun",\n      "OU_559",\n      "YuQRtpLP10I",\n      "Female",\n      "50"\n    ],\n    [\n      "IPNa7AsCyFt",\n      "Zj7UnCAulEk",\n      "2016-06-12",\n      "[5.22, 1.43]",\n      "Ngelehun",\n      "OU_559",\n      "YuQRtpLP10I",\n      "Female",\n      "50"\n    ],\n    [\n      "ZY9JL9dkhD2",\n      "Zj7UnCAulEk",\n      "2016-06-15",\n      "[5.42, 1.33]",\n      "Ngelehun",\n      "OU_559",\n      "YuQRtpLP10I",\n      "Female",\n      "50"\n    ],\n    [\n      "MYvh4WAUdWt",\n      "Zj7UnCAulEk",\n      "2016-06-16",\n      "[5.32, 1.53]",\n      "Ngelehun",\n      "OU_559",\n      "YuQRtpLP10I",\n      "Female",\n      "50"\n    ]\n  ]\n}\n')),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"headers"),' section of the response describes the content of the query\nresult. The event unique identifier, the program stage identifier, the\nevent date, the organisation unit name, the organisation unit code and\nthe organisation unit identifier appear as the first six dimensions in\nthe response and will always be present. Next comes the data elements,\nperson attributes and person identifiers which were specified as\ndimensions in the request, in this case, the "Gender" and "Age" data\nelement dimensions. The header section contains the identifier of the\ndimension item in the "name" property and a readable dimension\ndescription in the "column" property.'),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"metaData")," section, ",Object(r.b)("em",{parentName:"p"},"ou")," object contains the identifiers of all\norganisation units present in the response mapped to a string\nrepresenting the hierarchy. This hierarchy string lists the identifiers\nof the ancestors (parents) of the organisation unit starting from the\nroot. The ",Object(r.b)("em",{parentName:"p"},"names")," object contains the identifiers of all items in the\nresponse mapped to their names."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"rows")," section contains the events produced by the query. Each row\nrepresents exactly one event."),Object(r.b)("p",null,"In order to have the event analytics resource generate the data in the\nshape of a ready-made table, you can provide ",Object(r.b)("em",{parentName:"p"},"rows")," and ",Object(r.b)("em",{parentName:"p"},"columns"),"\nparameters with requested dimension identifiers separated by semi-colons\nas values to indicate which ones to use as table columns and rows.\nInstead of generating a plain, normalized data source, the event\nanalytics resource will now generate the data in table layout. The\ncolumn and rows dimensions must be present as a data dimension in the\nquery (not a filter). Such a request can look like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics.html+css?dimension=dx:cYeuwXTCPkU;fbfJHSPpUQD&dimension=pe:WEEKS_THIS_YEAR\n  &filter=ou:ImspTQPwCqd&displayProperty=SHORTNAME&columns=dx&rows=pe\n")),Object(r.b)("h3",{id:"event-aggregate-analytics"},"Event aggregate analytics"),Object(r.b)("p",null,"The ",Object(r.b)("inlineCode",{parentName:"p"},"/analytics/events/aggregate")," resource lets you retrieve ",Object(r.b)("em",{parentName:"p"},"aggregated\nnumbers")," of events captured in HRHIS4. This resource lets you retrieve\naggregate data based on a program and optionally a program stage, and\nlets you filter on any event dimension."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate\n")),Object(r.b)("p",null,"The events aggregate resource does not return the event information\nitself, rather the aggregate numbers of events matching the request\nquery. Event dimensions include data elements, person attributes, person\nidentifiers, periods and organisation units. Aggregate event queries\nshould be on the format described below."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/<program-id>?startDate=yyyy-MM-dd&endDate=yyyy-MM-dd\n  &dimension=ou:<ou-id>;<ou-id>&dimension=<item-id>&dimension=<item-id>:<operator>:<filter>\n")),Object(r.b)("p",null,'For example, to retrieve aggregate numbers for events from the\n"Inpatient morbidity and mortality" program between January and October\n2016, where the "Gender" and "Age" data elements are included, the "Age"\ndimension item is filtered on "18" and the "Gender" item is filtered on\n"Female", you can use the following query:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:O6uvpzGd5pu&dimension=oZg33kd9taw:EQ:Female&dimension=qrur9Dvnyt5:GT:50\n")),Object(r.b)("p",null,"To retrieve data for fixed and relative periods instead of start and end\ndate, in this case, May 2016 and last 12 months, and the organisation\nunit associated with the current user, you can use the following query:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc?dimension=pe:201605;LAST_12_MONTHS\n  &dimension=ou:USER_ORGUNIT;fdc6uOvgo7ji&dimension=oZg33kd9taw\n")),Object(r.b)("p",null,'In order to specify "Female" as a filter for "Gender" for the data\nresponse, meaning "Gender" will not be part of the response but will\nfilter the aggregate numbers in it, you can use the following syntax:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc?dimension=pe:2016;\n  &dimension=ou:O6uvpzGd5pu&filter=oZg33kd9taw:EQ:Female\n")),Object(r.b)("p",null,'To specify the "Bo" organisation unit and the period "2016" as filters,\nand the "Mode of discharge" and Gender" as dimensions, where "Gender" is\nfiltered on the "Male" item, you can use a query like this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc?filter=pe:2016&filter=ou:O6uvpzGd5pu\n  &dimension=fWIAEtYVEGk&dimension=oZg33kd9taw:EQ:Male\n")),Object(r.b)("p",null,'To create a "top 3 report" for "Mode of discharge" you can use the limit\nand sortOrder query parameters similar to this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc?filter=pe:2016&filter=ou:O6uvpzGd5pu\n  &dimension=fWIAEtYVEGk&limit=3&sortOrder=DESC\n")),Object(r.b)("p",null,"To specify a value dimension with a corresponding aggregation type you\ncan use the value and aggregationType query parameters. Specifying a\nvalue dimension will make the analytics engine return aggregate values\nfor the values of that dimension in the response as opposed to counts of\nevents."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc.json?stage=Zj7UnCAulEk&dimension=ou:ImspTQPwCqd\n  &dimension=pe:LAST_12_MONTHS&dimension=fWIAEtYVEGk&value=qrur9Dvnyt5&aggregationType=AVERAGE\n")),Object(r.b)("p",null,"To base event analytics aggregation on a specific data element or attribute\nof value type date or date time you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"timeField")," parameter:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/IpHINAT79UW.json?dimension=ou:ImspTQPwCqd\n&dimension=pe:LAST_12_MONTHS&dimension=cejWyOfXge6&stage=A03MvHHogjR&timeField=ENROLLMENT_DATE\n")),Object(r.b)("p",null,"To base event analytics aggregation on a specific data element or attribute\nof value type organisation unit you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"orgUnitField")," parameter:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc.json?dimension=ou:ImspTQPwCqd\n&dimension=pe:THIS_YEAR&dimension=oZg33kd9taw&stage=Zj7UnCAulEk&orgUnitField=S33cRBsnXPo\n")),Object(r.b)("h4",{id:"ranges--legend-sets"},"Ranges / legend sets"),Object(r.b)("p",null,'For aggregate queries, you can specify a range / legend set for numeric\ndata element and attribute dimensions. The purpose is to group the\nnumeric values into ranges. As an example, instead of generating data\nfor an "Age" data element for distinct years, you can group the\ninformation into age groups. To achieve this, the data element or\nattribute must be associated with the legend set. The format is\ndescribed below:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"?dimension=<item-id>-<legend-set-id>\n")),Object(r.b)("p",null,"An example looks like\nthis:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/aggregate/eBAyeGv0exc.json?stage=Zj7UnCAulEk\n  &dimension=qrur9Dvnyt5-Yf6UHoPkdS6&dimension=ou:ImspTQPwCqd&dimension=pe:LAST_MONTH\n")),Object(r.b)("h4",{id:"response-formats-2"},"Response formats"),Object(r.b)("p",null,"The default response representation format is JSON. The requests must be\nusing the HTTP ",Object(r.b)("em",{parentName:"p"},"GET")," method. The response will look similar to this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "headers": [\n    {\n      "name": "oZg33kd9taw",\n      "column": "Gender",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "qrur9Dvnyt5",\n      "column": "Age",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "pe",\n      "column": "Period",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "ou",\n      "column": "Organisation unit",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "value",\n      "column": "Value",\n      "type": "java.lang.String",\n      "meta": false\n    }\n  ],\n  "metaData": {\n    "names": {\n      "eBAyeGv0exc": "Inpatient morbidity and mortality"\n    }\n  },\n  "width": 5,\n  "height": 39,\n  "rows": [\n    [\n      "Female",\n      "95",\n      "201605",\n      "O6uvpzGd5pu",\n      "2"\n    ],\n    [\n      "Female",\n      "63",\n      "201605",\n      "O6uvpzGd5pu",\n      "2"\n    ],\n    [\n      "Female",\n      "67",\n      "201605",\n      "O6uvpzGd5pu",\n      "1"\n    ],\n    [\n      "Female",\n      "71",\n      "201605",\n      "O6uvpzGd5pu",\n      "1"\n    ],\n    [\n      "Female",\n      "75",\n      "201605",\n      "O6uvpzGd5pu",\n      "14"\n    ],\n    [\n      "Female",\n      "73",\n      "201605",\n      "O6uvpzGd5pu",\n      "5"\n    ]\n  ]\n}\n')),Object(r.b)("p",null,"Note that the max limit for rows to return in a single response is 10 000.\nIf the query produces more than the max limit, a ",Object(r.b)("em",{parentName:"p"},"409 Conflict")," status code\nwill be returned."),Object(r.b)("h3",{id:"event-clustering-analytics"},"Event clustering analytics"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"analytics/events/cluster")," resource provides clustered geospatial\nevent data. A request looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/cluster/eBAyeGv0exc?startDate=2016-01-01&endDate=2016-10-31\n  &dimension=ou:LEVEL-2&clusterSize=100000\n  &bbox=-13.2682125,7.3721619,-10.4261178,9.904012&includeClusterPoints=false\n")),Object(r.b)("p",null,"The cluster response provides the count of underlying points, the center\npoint and extent of each cluster. If the ",Object(r.b)("inlineCode",{parentName:"p"},"includeClusterPoints")," query\nparameter is set to true, a comma-separated string with the identifiers\nof the underlying events is included. A sample response looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "headers": [\n    {\n      "name": "count",\n      "column": "Count",\n      "type": "java.lang.Long",\n      "meta": false\n    },\n    {\n      "name": "center",\n      "column": "Center",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "extent",\n      "column": "Extent",\n      "type": "java.lang.String",\n      "meta": false\n    },\n    {\n      "name": "points",\n      "column": "Points",\n      "type": "java.lang.String",\n      "meta": false\n    }\n  ],\n  "width": 3,\n  "height": 4,\n  "rows": [\n    [\n      "3",\n      "POINT(-13.15818 8.47567)",\n      "BOX(-13.26821 8.4St7215,-13.08711 8.47807)",\n      ""\n    ],\n    [\n      "9",\n      "POINT(-13.11184 8.66424)",\n      "BOX(-13.24982 8.51961,-13.05816 8.87696)",\n      ""\n    ],\n    [\n      "1",\n      "POINT(-12.46144 7.50597)",\n      "BOX(-12.46144 7.50597,-12.46144 7.50597)",\n      ""\n    ],\n    [\n      "7",\n      "POINT(-12.47964 8.21533)",\n      "BOX(-12.91769 7.66775,-12.21011 8.49713)",\n      ""\n    ]\n  ]\n}\n')),Object(r.b)("h3",{id:"event-count-and-extent-analytics"},"Event count and extent analytics"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"analytics/events/count")," resource is suitable for geometry-related\nrequests for retrieving the count and extent (bounding box) of events\nfor a specific query. The query syntax is equal to the ",Object(r.b)("em",{parentName:"p"},"events/query"),"\nresource. A request looks like\nthis:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/events/count/eBAyeGv0exc?startDate=2016-01-01\n  &endDate=2016-10-31&dimension=ou:O6uvpzGd5pu\n")),Object(r.b)("p",null,"The response will provide the count and extent in JSON format:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  extent: "BOX(-13.2682125910096 7.38679562779441,-10.4261178860988 9.90401290212795)",\n  count: 59\n}\n')),Object(r.b)("h3",{id:"constraints-and-validation-1"},"Constraints and validation"),Object(r.b)("p",null,"There are several constraints to the input parameters you can provide to the\nevent analytics resource. If any of the constraints are violated, the API will\nreturn a ",Object(r.b)("em",{parentName:"p"},"409 Conflict")," response and a response message looking similar to this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "httpStatus": "Conflict",\n  "httpStatusCode": 409,\n  "status": "ERROR",\n  "message": "At least one organisation unit must be specified",\n  "errorCode": "E7200"\n}\n')),Object(r.b)("p",null,"The possible validation errors for the event analytics API are described\nin the table below."),Object(r.b)("table",null,Object(r.b)("thead",{parentName:"table"},Object(r.b)("tr",{parentName:"thead"},Object(r.b)("th",{parentName:"tr",align:null},"Error code"),Object(r.b)("th",{parentName:"tr",align:null},"Message"))),Object(r.b)("tbody",{parentName:"table"},Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7200"),Object(r.b)("td",{parentName:"tr",align:null},"At least one organisation unit must be specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7201"),Object(r.b)("td",{parentName:"tr",align:null},"Dimensions cannot be specified more than once")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7202"),Object(r.b)("td",{parentName:"tr",align:null},"Query items cannot be specified more than once")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7203"),Object(r.b)("td",{parentName:"tr",align:null},"Value dimension cannot also be specified as an item or item filter")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7204"),Object(r.b)("td",{parentName:"tr",align:null},"Value dimension or aggregate data must be specified when aggregation type is specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7205"),Object(r.b)("td",{parentName:"tr",align:null},"Start and end date or at least one period must be specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7206"),Object(r.b)("td",{parentName:"tr",align:null},"Start date is after end date")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7207"),Object(r.b)("td",{parentName:"tr",align:null},"Page number must be a positive number")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7208"),Object(r.b)("td",{parentName:"tr",align:null},"Page size must be zero or a positive number")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7209"),Object(r.b)("td",{parentName:"tr",align:null},"Limit is larger than max limit")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7210"),Object(r.b)("td",{parentName:"tr",align:null},"Time field is invalid")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7211"),Object(r.b)("td",{parentName:"tr",align:null},"Org unit field is invalid")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7212"),Object(r.b)("td",{parentName:"tr",align:null},"Cluster size must be a positive number")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7213"),Object(r.b)("td",{parentName:"tr",align:null},"Bbox is invalid, must be on format: 'min-lng,min-lat,max-lng,max-lat'")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7214"),Object(r.b)("td",{parentName:"tr",align:null},"Cluster field must be specified when bbox or cluster size are specified")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7215"),Object(r.b)("td",{parentName:"tr",align:null},"Query item cannot specify both legend set and option set")),Object(r.b)("tr",{parentName:"tbody"},Object(r.b)("td",{parentName:"tr",align:null},"E7216"),Object(r.b)("td",{parentName:"tr",align:null},"Query item must be aggregateable when used in aggregate query")))),Object(r.b)("h2",{id:"enrollment-analytics"},"Enrollment analytics"),Object(r.b)("p",null,"The enrollment analytics API lets you access aggregated event data and query ",Object(r.b)("em",{parentName:"p"},"enrollments with their event data")," captured in HRHIS4. This resource lets you retrieve data for a program based on program stages and data elements - in addition to tracked entity attributes. When querying event data for a specific programstages within each enrollment, the data element values for each program stage will be returned as one row in the response from the api. If querying a data element in a program stage that is repeatable, the newest data element value will be used for that data element in the api response."),Object(r.b)("h3",{id:"dimensions-and-items-2"},"Dimensions and items"),Object(r.b)("p",null,"Enrollment dimensions include data elements, attributes, organisation units and periods. The query analytics resource will simply return enrollments matching a set of criteria and does not perform any aggregation."),Object(r.b)("h3",{id:"enrollment-query-analytics"},"Enrollment query analytics"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"analytics/enrollments/query")," resource lets you query for captured enrollments. This resource does not perform any aggregation, rather it lets you query and filter for information about enrollments."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query\n")),Object(r.b)("p",null,"You can specify any number of dimensions and any number of filters in a query. Dimension item identifiers can refer to any of the data elements in program stages, tracked entity attributes, fixed and relative periods and organisation units. Dimensions can optionally have a query operator and a filter. Enrollment queries should be on the format described below."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/<program-id>?startDate=yyyy-MM-dd&endDate=yyyy-MM-dd\n  &dimension=ou:<ou-id>;<ou-id>&dimension=<item-id>&dimension=<item-id>:<operator>:<filter>\n")),Object(r.b)("p",null,'For example, to retrieve enrollments in the from the "Antenatal care" program from January 2019, where the "First name" is picked up from attributes, "Chronic conditions" and "Smoking" data elements are included from the first program stage, and "Hemoglobin value" from the following program stage, and only women that have "Cronic conditions" would be included, you can use the following query:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.json?dimension=ou:ImspTQPwCqd\n  &dimension=w75KJ2mc4zz&dimension=WZbXY0S00lP.de0FEHSIoxh:eq:1&dimension=w75KJ2mc4zz\n  &dimension=WZbXY0S00lP.sWoqcoByYmD&dimension=edqlbukwRfQ.vANAXwtLwcT\n  &startDate=2019-01-01&endDate=2019-01-31\n")),Object(r.b)("p",null,'To retrieve enrollments in the from the "Antenatal care" program from last month (relative to the point in time the query is executed), where the "Chronic conditions" and "Smoking" data elements are included from the first program stage, and "Hemoglobin value" from the followup program stage, only including smoking women with hemoglobin less than 20:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.json?dimension=ou:ImspTQPwCqd\n  &dimension=WZbXY0S00lP.de0FEHSIoxh&dimension=w75KJ2mc4zz\n  &dimension=WZbXY0S00lP.sWoqcoByYmD:eq:1&dimension=edqlbukwRfQ.vANAXwtLwcT:lt:20\n  &dimension=pe:LAST_MONTH\n")),Object(r.b)("p",null,"Sorting can be applied to the query for the enrollment and incident dates of the enrollment:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.xls?dimension=ou:ImspTQPwCqd\n  &columns=w75KJ2mc4zz&dimension=WZbXY0S00lP.sWoqcoByYmD&dimension=pe:LAST_MONTH\n  &stage=WZbXY0S00lP&pageSize=10&page=1&asc=ENROLLMENTDATE&ouMode=DESCENDANTS\n")),Object(r.b)("p",null,"Paging can be applied to the query by specifying the page number and the page size parameters. If page number is specified but page size is not, a page size of 50 will be used. If page size is specified but page number is not, a page number of 1 will be used. To get the second page of the response with a page size of 10 you can use a query like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.json?dimension=ou:ImspTQPwCqd\n  &dimension=WZbXY0S00lP.de0FEHSIoxh&dimension=w75KJ2mc4zz&dimension=pe:LAST_MONTH\n  &dimension=WZbXY0S00lP.sWoqcoByYmD&pageSize=10&page=2\n")),Object(r.b)("h4",{id:"filtering-1"},"Filtering"),Object(r.b)("p",null,"Filters can be applied to data elements, person attributes and person identifiers. The filtering is done through the query parameter value on the following format:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=<item-id>:<operator>:<filter-value>\n")),Object(r.b)("p",null,'As an example, you can filter the "Weight" data element for values greater than 2000 and lower than 4000 like this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=WZbXY0S00lP.UXz7xuGCEhU:GT:2000&dimension=WZbXY0S00lP.UXz7xuGCEhU:LT:4000\n")),Object(r.b)("p",null,'You can filter the "Age" attribute for multiple, specific ages using the IN operator like this:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=qrur9Dvnyt5:IN:18;19;20\n")),Object(r.b)("p",null,"You can specify multiple filters for a given item by repeating the operator and filter components, all separated with semi-colons:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"&dimension=qrur9Dvnyt5:GT:5:LT:15\n")),Object(r.b)("p",null,"The available operators are listed below."),Object(r.b)("h3",{id:"request-query-parameters-2"},"Request query parameters"),Object(r.b)("p",null,"The analytics enrollment query API lets you specify a range of query parameters."),Object(r.b)("h4",{id:"response-formats-3"},"Response formats"),Object(r.b)("p",null,"The default response representation format is JSON. The requests must be using the HTTP ",Object(r.b)("em",{parentName:"p"},"GET")," method. The following response formats are supported."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"json (application/json)"),Object(r.b)("li",{parentName:"ul"},"xml (application/xml)"),Object(r.b)("li",{parentName:"ul"},"xls (application/vnd.ms-excel)"),Object(r.b)("li",{parentName:"ul"},"csv  (application/csv)"),Object(r.b)("li",{parentName:"ul"},"html (text/html)"),Object(r.b)("li",{parentName:"ul"},"html+css (text/html)")),Object(r.b)("p",null,"As an example, to get a response in Excel format you can use a file extension in the request URL like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.xls?dimension=ou:ImspTQPwCqd\n  &dimension=WZbXY0S00lP.de0FEHSIoxh&columns=w75KJ2mc4zz\n  &dimension=WZbXY0S00lP.sWoqcoByYmD&dimension=pe:LAST_MONTH&stage=WZbXY0S00lP\n  &pageSize=10&page=1&asc=ENROLLMENTDATE&ouMode=DESCENDANTS\n")),Object(r.b)("p",null,"The default response JSON format will look similar to this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "headers": [\n    {\n      "name": "pi",\n      "column": "Enrollment",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "tei",\n      "column": "Tracked entity instance",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "enrollmentdate",\n      "column": "Enrollment date",\n      "valueType": "DATE",\n      "type": "java.util.Date",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "incidentdate",\n      "column": "Incident date",\n      "valueType": "DATE",\n      "type": "java.util.Date",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "geometry",\n      "column": "Geometry",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "longitude",\n      "column": "Longitude",\n      "valueType": "NUMBER",\n      "type": "java.lang.Double",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "latitude",\n      "column": "Latitude",\n      "valueType": "NUMBER",\n      "type": "java.lang.Double",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "ouname",\n      "column": "Organisation unit name",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "oucode",\n      "column": "Organisation unit code",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "ou",\n      "column": "Organisation unit",\n      "valueType": "TEXT",\n      "type": "java.lang.String",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "de0FEHSIoxh",\n      "column": "WHOMCH Chronic conditions",\n      "valueType": "BOOLEAN",\n      "type": "java.lang.Boolean",\n      "hidden": false,\n      "meta": true\n    },\n    {\n      "name": "sWoqcoByYmD",\n      "column": "WHOMCH Smoking",\n      "valueType": "BOOLEAN",\n      "type": "java.lang.Boolean",\n      "hidden": false,\n      "meta": true\n    }\n  ],\n  "metaData": {\n    "pager": {\n      "page": 2,\n      "total": 163,\n      "pageSize": 4,\n      "pageCount": 41\n    },\n    "items": {\n      "ImspTQPwCqd": {\n        "name": "Sierra Leone"\n      },\n      "PFDfvmGpsR3": {\n        "name": "Care at birth"\n      },\n      "bbKtnxRZKEP": {\n        "name": "Postpartum care visit"\n      },\n      "ou": {\n        "name": "Organisation unit"\n      },\n      "PUZaKR0Jh2k": {\n        "name": "Previous deliveries"\n      },\n      "edqlbukwRfQ": {\n        "name": "Antenatal care visit"\n      },\n      "WZbXY0S00lP": {\n        "name": "First antenatal care visit"\n      },\n      "sWoqcoByYmD": {\n        "name": "WHOMCH Smoking"\n      },\n      "WSGAb5XwJ3Y": {\n        "name": "WHO RMNCH Tracker"\n      },\n      "de0FEHSIoxh": {\n        "name": "WHOMCH Chronic conditions"\n      }\n    },\n    "dimensions": {\n      "pe": [],\n      "ou": [\n        "ImspTQPwCqd"\n      ],\n      "sWoqcoByYmD": [],\n      "de0FEHSIoxh": []\n    }\n  },\n  "width": 12,\n  "rows": [\n    [\n      "A0cP533hIQv",\n      "to8G9jAprnx",\n      "2019-02-02 12:05:00.0",\n      "2019-02-02 12:05:00.0",\n      "",\n      "0.0",\n      "0.0",\n      "Tonkomba MCHP",\n      "OU_193264",\n      "xIMxph4NMP1",\n      "0",\n      "1"\n    ],\n    [\n      "ZqiUn2uXmBi",\n      "SJtv0WzoYki",\n      "2019-02-02 12:05:00.0",\n      "2019-02-02 12:05:00.0",\n      "",\n      "0.0",\n      "0.0",\n      "Mawoma MCHP",\n      "OU_254973",\n      "Srnpwq8jKbp",\n      "0",\n      "0"\n    ],\n    [\n      "lE747mUAtbz",\n      "PGzTv2A1xzn",\n      "2019-02-02 12:05:00.0",\n      "2019-02-02 12:05:00.0",\n      "",\n      "0.0",\n      "0.0",\n      "Kunsho CHP",\n      "OU_193254",\n      "tdhB1JXYBx2",\n      "",\n      "0"\n    ],\n    [\n      "nmcqu9QF8ow",\n      "pav3tGLjYuq",\n      "2019-02-03 12:05:00.0",\n      "2019-02-03 12:05:00.0",\n      "",\n      "0.0",\n      "0.0",\n      "Korbu MCHP",\n      "OU_678893",\n      "m73lWmo5BDG",\n      "",\n      "1"\n    ]\n  ],\n  "height": 4\n}\n')),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"headers"),' section of the response describes the content of the query result. The enrollment unique identifier, the tracked entity instance identifier, the enrollment date, the incident date, geometry, latitude, longitude, the organisation unit name and the organisation unit code appear as the first dimensions in the response and will always be present. Next comes the data elements, and tracked entity attributes which were specified as dimensions in the request, in this case, the "WHOMCH Chronic conditions" and "WHOMCH smoking" data element dimensions. The header section contains the identifier of the dimension item in the "name" property and a readable dimension description in the "column" property.'),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"metaData")," section, ",Object(r.b)("em",{parentName:"p"},"ou")," object contains the identifiers of all organisation units present in the response mapped to a string representing the hierarchy. This hierarchy string lists the identifiers of the ancestors (parents) of the organisation unit starting from the root. The ",Object(r.b)("em",{parentName:"p"},"names")," object contains the identifiers of all items in the response mapped to their names."),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"rows")," section contains the enrollments produced by the query. Each row represents exactly one enrollment."),Object(r.b)("h3",{id:"support-of-analytics-across-tracked-entity-instance-relationships-with-program-indicators"},"Support of analytics across tracked entity instance relationships with program indicators"),Object(r.b)("p",null,"The non-aggregation enrollment analytics API also supports linking Program Indicators to Relationship Types, in order to show the result of a calculation of a specific Program Indicator applied to the related entities of the listed Tracked Entity Instance."),Object(r.b)("p",null,"For the Program Indicator/Relationship Type link to work, the ",Object(r.b)("inlineCode",{parentName:"p"},"/api/analytics/enrollments/query")," API requires an additional dimension which must include the chosen Relationship Type UID and the chosen Program Indicator UID:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/<program-id>\n  ?dimension=<relationshiptype-id>.<programindicator-id>\n")),Object(r.b)("p",null,'For example, to retrieve a list of enrollments from the "WHO RMNCH Tracker" program for January 2019 and display the count of Malaria Cases linked to that Enrollment by "Malaria case linked to person" type of relationship, you can use the following query'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/analytics/enrollments/query/WSGAb5XwJ3Y.json?dimension=mxZDvSZYxlw.nFICjJluo74\n  &startDate=2019-01-01&endDate=2019-01-31    \n")),Object(r.b)("p",null,'The API supports using program indicators which are not associated to the "main" program (that is the program ID specified after ',Object(r.b)("inlineCode",{parentName:"p"},"/query/"),")."),Object(r.b)("h2",{id:"org-unit-analytics"},"Org unit analytics"),Object(r.b)("p",null,"The org unit analytics API provides statistics on org units classified by org unit group sets, i.e. counts of org units per org unit group within org unit group sets."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/orgUnitAnalytics?ou=<org-unit-id>&ougs=<org-unit-group-set-id>\n")),Object(r.b)("p",null,"The API requires at least one organisation unit and at least one organisation unit group set. Multiple org units and group sets can be provided separated by a semicolon."),Object(r.b)("h3",{id:"request-query-parameters-3"},"Request query parameters"),Object(r.b)("p",null,"The org unit analytics resource lets you specify a range of query parameters:"),Object(r.b)("p",null,"The response will contain a column for the parent org unit, columns for each org unit group set part of the request and a column for the count. The statistics include the count of org units which are part of the sub-hierarchy of the org units specified in the request. The response contains a metadata section which specifies the name of each org unit and org unit group part of the response referenced by their identifiers."),Object(r.b)("p",null,"The default response is normalized with a single ",Object(r.b)("inlineCode",{parentName:"p"},"count")," column. The response can be rendered in a table layout by specifying at least one org unit group set using the ",Object(r.b)("inlineCode",{parentName:"p"},"columns")," query parameter."),Object(r.b)("h3",{id:"response-formats-4"},"Response formats"),Object(r.b)("p",null,"The org unit analytics endpoint supports the following representation formats:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"json (application/json)"),Object(r.b)("li",{parentName:"ul"},"csv (application/csv)"),Object(r.b)("li",{parentName:"ul"},"xls (application/vnd.ms-excel)"),Object(r.b)("li",{parentName:"ul"},"pdf (application/pdf)")),Object(r.b)("h3",{id:"examples"},"Examples"),Object(r.b)("p",null,"To fetch org unit analytics for an org unit and org unit group set:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/orgUnitAnalytics?ou=lc3eMKXaEfw&ougs=J5jldMd8OHv\n")),Object(r.b)("p",null,"To fetch org unit analytics data for two org units and two org unit group sets:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/orgUnitAnalytics?ou=lc3eMKXaEfw;PMa2VCrupOd&ougs=J5jldMd8OHv;Bpx0589u8y0\n")),Object(r.b)("p",null,"To fetch org unit analytics data in table mode with one group set rendered as columns:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/orgUnitAnalytics?ou=fdc6uOvgoji;jUb8gELQApl;lc3eMKXaEfw;PMa2VCrupOd\n  &ougs=J5jldMd8OHv&columns=J5jldMd8OHv\n")),Object(r.b)("h2",{id:"data-set-report"},"Data set report"),Object(r.b)("p",null,"Data set reports can be generated through the web api using the\n",Object(r.b)("inlineCode",{parentName:"p"},"/dataSetReport")," resource. This resource generates reports on data set\nand returns the result in the form of an HTML table."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataSetReport\n")),Object(r.b)("h3",{id:"request-query-parameters-4"},"Request query parameters"),Object(r.b)("p",null,"The request supports the following parameters:"),Object(r.b)("p",null,"The data set report resource accepts ",Object(r.b)("inlineCode",{parentName:"p"},"GET")," requests only. The response content type is ",Object(r.b)("inlineCode",{parentName:"p"},"application/json")," and returns data in a grid. This endpoint works for all types of data sets, including default, section and custom forms."),Object(r.b)("p",null,"An example request to retrieve a report for a data set and org unit for 2018 looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/dataSetReport?ds=BfMAe6Itzgt&pe=201810&ou=ImspTQPwCqd&selectedUnitOnly=false\n")),Object(r.b)("p",null,"To get a data set report with a filter you can use the ",Object(r.b)("inlineCode",{parentName:"p"},"filter")," parameter. In this case, the filter is based on an org unit group set and two org unit groups:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/dataSetReport?ds=BfMAe6Itzgt&pe=201810&ou=ImspTQPwCqd\n  &filter=J5jldMd8OHv:RXL3lPSK8oG;tDZVQ1WtwpA\n")),Object(r.b)("h3",{id:"response-formats-5"},"Response formats"),Object(r.b)("p",null,"The data set report endpoint supports output in the following formats. You can retrieve a specific endpoint using the file extension or ",Object(r.b)("inlineCode",{parentName:"p"},"Accept")," HTTP header."),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},"json (application/json)"),Object(r.b)("li",{parentName:"ul"},"pdf (application/pdf)"),Object(r.b)("li",{parentName:"ul"},"xls (application/vnd.ms-excel)")),Object(r.b)("h3",{id:"custom-forms"},"Custom forms"),Object(r.b)("p",null,"A dedicated endpoint is available for data sets with custom HTML forms. This endpoint returns the HTML form content with content type ",Object(r.b)("inlineCode",{parentName:"p"},"text/html")," with data inserted into it. Note that you can use the general data set report endpoint also for data sets with custom forms; however, that will return the report in JSON format as a grid. This endpoint only works for data sets with custom HTML forms."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/dataSetReport/custom\n")),Object(r.b)("p",null,"The syntax for this endpoint is otherwise equal to the general data set report endpoint. To retrieve a custom HTML data set report you can issue a request like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/dataSetReport/custom?ds=lyLU2wR22tC&pe=201810&ou=ImspTQPwCqd\n")),Object(r.b)("h2",{id:"data-usage-analytics"},"Data usage analytics"),Object(r.b)("p",null,"The usage analytics API lets you access information about how people are\nusing HRHIS4 based on data analysis. When users access favorites, an\nevent is recorded. The event consists of the user name, the UID of the\nfavorite, when the event took place, and the type of event. The\ndifferent types of events are listed in the table."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataStatistics\n")),Object(r.b)("p",null,"The usage analytics API lets you retrieve aggregated snapshots of usage\nanalytics based on time intervals. The API captures user views (for\nexample the number of times a chart or pivot table has been viewed by a\nuser) and saved analysis favorites (for example favorite charts and\npivot tables). HRHIS4 will capture nightly snapshots which are then\naggregated at request."),Object(r.b)("h3",{id:"request-query-parameters-5"},"Request query parameters"),Object(r.b)("p",null,"The usage analytics (data statistics) API supports two operations:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("em",{parentName:"p"},"POST:")," creates a view event")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},Object(r.b)("em",{parentName:"p"},"GET:")," retrieves aggregated statistics"))),Object(r.b)("h3",{id:"create-view-events-post"},"Create view events (POST)"),Object(r.b)("p",null,"The usage analytics API lets you create event views. The\ndataStatisticsEventType parameter describes what type of item was\nviewed. The favorite parameter indicates the identifier of the relevant\nfavorite."),Object(r.b)("p",null,"URL that creates a new event view of\ncharts:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"POST /api/dataStatistics?eventType=CHART_VIEW&favorite=LW0O27b7TdD\n")),Object(r.b)("p",null,"A successful save operation returns an HTTP status code 201. The table\nbelow shows the supported types of events."),Object(r.b)("h3",{id:"retrieve-aggregated-usage-analytics-report-get"},"Retrieve aggregated usage analytics report (GET)"),Object(r.b)("p",null,"The usage analytics (data statistics) API lets you specify certain query\nparameters when asking for an aggregated report."),Object(r.b)("p",null,"The startDate and endDate parameters specify the period for which\nsnapshots are to be used in the aggregation. You must format the dates\nas shown above. If no snapshots are saved in the specified period, an\nempty list is sent back. The parameter called interval specifies what\ntype of aggregation will be done."),Object(r.b)("p",null,"API query that creates a query for a monthly\naggregation:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"GET /api/dataStatistics?startDate=2014-01-02&endDate=2016-01-01&interval=MONTH\n")),Object(r.b)("h3",{id:"retrieve-top-favorites"},"Retrieve top favorites"),Object(r.b)("p",null,"The usage analytics API lets you retrieve the top favorites used in\nHRHIS4, and by user."),Object(r.b)("p",null,"The API query can be used without a username, and will then find the top\nfavorites of the system."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataStatistics/favorites?eventType=CHART_VIEW&pageSize=25&sortOrder=ASC\n")),Object(r.b)("p",null,"If the username is specified, the response will only contain the top favorites of that user."),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataStatistics/favorites?eventType=CHART_VIEW&pageSize=25&sortOrder=ASC&username=admin\n")),Object(r.b)("h3",{id:"response-format"},"Response format"),Object(r.b)("p",null,"You can return the aggregated data in a usage analytics response in\nseveral representation formats. The default format is JSON. The\navailable formats and content types are:"),Object(r.b)("ul",null,Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"json (application/json)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"xml (application/xml)")),Object(r.b)("li",{parentName:"ul"},Object(r.b)("p",{parentName:"li"},"html (text/html)"))),Object(r.b)("p",null,"API query that requests a usage analytics response in XML\nformat:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataStatistics.xml?startDate=2014-01-01&endDate=2016-01-01&interval=WEEK\n")),Object(r.b)("p",null,"You must retrieve the aggregated usage analytics response with the HTTP\nGET method. This allows you to link directly from Web pages and other\nHTTP-enabled clients to usage analytics responses. To do functional\ntesting use the cURL library."),Object(r.b)("p",null,"Execute this command against the demo database to get an usage analytics\nresponse in JSON format:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-bash"},'curl "dev.hrhis.dhis2udsm.org/demo/api/dataStatistics?startDate=2016-02-01&endDate=2016-02-14\n  &interval=WEEK" -u admin:district\n')),Object(r.b)("p",null,"The JSON response looks like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'[\n  {\n    "year": 2016,\n    "week": 5,\n    "mapViews": 2181,\n    "chartViews": 2227,\n    "reportTableViews": 5633,\n    "eventReportViews": 6757,\n    "eventChartViews": 9860,\n    "dashboardViews": 10082,\n    "totalViews": 46346,\n    "averageViews": 468,\n    "averageMapViews": 22,\n    "averageChartViews": 22,\n    "averageReportTableViews": 56,\n    "averageEventReportViews": 68,\n    "averageEventChartViews": 99,\n    "averageDashboardViews": 101,\n    "savedMaps": 1805,\n    "savedCharts": 2205,\n    "savedReportTables": 1995,\n    "savedEventReports": 1679,\n    "savedEventCharts": 1613,\n    "savedDashboards": 0,\n    "savedIndicators": 1831,\n    "activeUsers": 99,\n    "users": 969\n  },\n  {\n    "year": 2016,\n    "week": 6,\n    "mapViews": 2018,\n    "chartViews": 2267,\n    "reportTableViews": 4714,\n    "eventReportViews": 6697,\n    "eventChartViews": 9511,\n    "dashboardViews": 12181,\n    "totalViews": 47746,\n    "averageViews": 497,\n    "averageMapViews": 21,\n    "averageChartViews": 23,\n    "averageReportTableViews": 49,\n    "averageEventReportViews": 69,\n    "averageEventChartViews": 99,\n    "averageDashboardViews": 126,\n    "savedMaps": 1643,\n    "savedCharts": 1935,\n    "savedReportTables": 1867,\n    "savedEventReports": 1977,\n    "savedEventCharts": 1714,\n    "savedDashboards": 0,\n    "savedIndicators": 1646,\n    "activeUsers": 96,\n    "users": 953\n  }\n]\n')),Object(r.b)("h3",{id:"retrieve-statistics-for-a-favorite"},"Retrieve statistics for a favorite"),Object(r.b)("p",null,"You can retrieve the number of view for a specific favorite by using the\n",Object(r.b)("em",{parentName:"p"},"favorites")," resource, where ",Object(r.b)("em",{parentName:"p"},"{favorite-id}")," should be substituted with\nthe identifier of the favorite of interest:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/dataStatistics/favorites/{favorite-id}.json\n")),Object(r.b)("p",null,"The response will contain the number of views for the given favorite and\nlook like this:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre",className:"language-json"},'{\n  "views": 3\n}\n')),Object(r.b)("h2",{id:"geospatial-features"},"Geospatial features"),Object(r.b)("p",null,"The ",Object(r.b)("em",{parentName:"p"},"geoFeatures")," resource lets you retrieve geospatial information from\nHRHIS4. Geospatial features are stored together with organisation units.\nThe syntax for retrieving features is identical to the syntax used for\nthe organisation unit dimension for the analytics resource. It is\nrecommended to read up on the analytics api resource before continuing\nto read this section. You must use the GET request type, and only JSON\nresponse format is supported."),Object(r.b)("p",null,"As an example, to retrieve geo features for all organisation units at\nlevel 3 in the organisation unit hierarchy you can use a GET request\nwith the following URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/geoFeatures.json?ou=ou:LEVEL-3\n")),Object(r.b)("p",null,"To retrieve geo features for organisation units at a level within the\nboundary of an organisation unit (e.g. at level 2) you can use this URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/geoFeatures.json?ou=ou:LEVEL-4;O6uvpzGd5pu\n")),Object(r.b)("p",null,"The semantics of the response properties are described in the following\ntable."),Object(r.b)("h3",{id:"geojson"},"GeoJSON"),Object(r.b)("p",null,"To export GeoJSON, you can simply add ",Object(r.b)("em",{parentName:"p"},".geosjon")," as an extension to the\nendpoint ",Object(r.b)("em",{parentName:"p"},"/api/organisationUnits"),", or you can use the ",Object(r.b)("em",{parentName:"p"},"Accept")," header\n",Object(r.b)("em",{parentName:"p"},"application/json+geojson"),"."),Object(r.b)("p",null,"Two parameters are supported: ",Object(r.b)("inlineCode",{parentName:"p"},"level")," (defaults to 1) and ",Object(r.b)("inlineCode",{parentName:"p"},"parent"),"\n(defaults to root organisation units). Both can be included multiple times.\nSome examples follow."),Object(r.b)("p",null,"Get all features at level 2 and 4:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/organisationUnits.geojson?level=2&level=4\n")),Object(r.b)("p",null,"Get all features at level 3 with a boundary organisation unit:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/organisationUnits.geojson?parent=fdc6uOvgoji&level=3\n")),Object(r.b)("h2",{id:"generating-resource-and-analytics-tables"},"Generating resource and analytics tables"),Object(r.b)("p",null,"HRHIS4 features a set of generated database tables which are used as\na basis for various system functionality. These tables can be executed\nimmediately or scheduled to be executed at regular intervals through the\nuser interface. They can also be generated through the Web API as\nexplained in this section. This task is typically one for a system\nadministrator and not consuming clients."),Object(r.b)("p",null,"The resource tables are used internally by the HRHIS4 application for\nvarious analysis functions. These tables are also valuable for users\nwriting advanced SQL reports. They can be generated with a POST or PUT\nrequest to the following URL:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/resourceTables\n")),Object(r.b)("p",null,"The analytics tables are optimized for data aggregation and used\ncurrently in HRHIS4 for the pivot table module. The analytics tables can\nbe generated with a POST or PUT request to:"),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/resourceTables/analytics\n")),Object(r.b)("p",null,'"Data Quality" and "Data Surveillance" can be run through the monitoring\ntask, triggered with the following endpoint:'),Object(r.b)("pre",null,Object(r.b)("code",{parentName:"pre"},"/api/resourceTables/monitoring\n")),Object(r.b)("p",null,"This task will analyse your validation rules, find any violations and\npersist them as validation results."),Object(r.b)("p",null,"These requests will return immediately and initiate a server-side\nprocess."))}d.isMDXComponent=!0},114:function(e,n,t){"use strict";t.d(n,"a",(function(){return c})),t.d(n,"b",(function(){return m}));var a=t(0),i=t.n(a);function r(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function o(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){r(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)t=r[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var p=i.a.createContext({}),d=function(e){var n=i.a.useContext(p),t=n;return e&&(t="function"==typeof e?e(n):o(o({},n),e)),t},c=function(e){var n=d(e.components);return i.a.createElement(p.Provider,{value:n},e.children)},u={inlineCode:"code",wrapper:function(e){var n=e.children;return i.a.createElement(i.a.Fragment,{},n)}},b=i.a.forwardRef((function(e,n){var t=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(t),b=a,m=c["".concat(s,".").concat(b)]||c[b]||u[b]||r;return t?i.a.createElement(m,o(o({ref:n},p),{},{components:t})):i.a.createElement(m,o({ref:n},p))}));function m(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var r=t.length,s=new Array(r);s[0]=b;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o.mdxType="string"==typeof e?e:a,s[1]=o;for(var p=2;p<r;p++)s[p]=t[p];return i.a.createElement.apply(null,s)}return i.a.createElement.apply(null,t)}b.displayName="MDXCreateElement"}}]);
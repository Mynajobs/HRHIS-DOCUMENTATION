"use strict";(self.webpackChunkhris_api_docs=self.webpackChunkhris_api_docs||[]).push([[535],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return m}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),d=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=d(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,h=c["".concat(s,".").concat(m)]||c[m]||u[m]||i;return n?a.createElement(h,o(o({ref:t},p),{},{components:n})):a.createElement(h,o({ref:t},p))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var d=2;d<i;d++)o[d]=n[d];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},5246:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return p},default:function(){return c}});var a=n(7462),r=n(3366),i=(n(7294),n(3905)),o=["components"],l={id:"data-quality",title:"Data quality Module",sidebar_label:"Data quality"},s=void 0,d={unversionedId:"developers/data/data-quality",id:"developers/data/data-quality",isDocsHomePage:!1,title:"Data quality Module",description:"Record Duplicates and Merging API",source:"@site/docs/developers/data/dataQuality.md",sourceDirName:"developers/data",slug:"/developers/data/data-quality",permalink:"/hris-api-docs/docs/developers/data/data-quality",editUrl:"https://github.com/udsm-dhis2-project/hris-api-docs/blob/main/docs/developers/data/dataQuality.md",tags:[],version:"current",frontMatter:{id:"data-quality",title:"Data quality Module",sidebar_label:"Data quality"},sidebar:"docs",previous:{title:"Datastore",permalink:"/hris-api-docs/docs/developers/data/datastore"},next:{title:"Education Records",permalink:"/hris-api-docs/docs/developers/data/education-records"}},p=[{value:"Record Duplicates and Merging API",id:"record-duplicates-and-merging-api",children:[],level:3},{value:"Get Duplicate Records.",id:"get-duplicate-records",children:[],level:2},{value:"Merging Duplicates",id:"merging-duplicates",children:[{value:"Scenario One || Based on Records",id:"scenario-one--based-on-records",children:[],level:3},{value:"Scenario One || Based on Selected Fields",id:"scenario-one--based-on-selected-fields",children:[],level:3}],level:2},{value:"Record values",id:"record-values",children:[{value:"Sending record values",id:"sending-record-values",children:[],level:3},{value:"Sending bulks of record values",id:"sending-bulks-of-record-values",children:[],level:3},{value:"Import parameters",id:"import-parameters",children:[{value:"record values requirements",id:"record-values-requirements",children:[],level:4},{value:"Identifier schemes",id:"identifier-schemes",children:[],level:4},{value:"Async record values import",id:"async-record-values-import",children:[],level:4}],level:3},{value:"CSV record values format",id:"csv-record-values-format",children:[],level:3},{value:"Generating record values set template",id:"generating-record-values-set-template",children:[],level:3},{value:"Reading record values",id:"reading-record-values",children:[],level:3},{value:"Sending, reading and deleting individual record values",id:"sending-reading-and-deleting-individual-record-values",children:[{value:"Working with file record values",id:"working-with-file-record-values",children:[],level:4}],level:3}],level:2}],u={toc:p};function c(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h3",{id:"record-duplicates-and-merging-api"},"Record Duplicates and Merging API"),(0,i.kt)("h2",{id:"get-duplicate-records"},"Get Duplicate Records."),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Endpoint")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-JS"},"/api/records/duplicates/hshD7171OpG\n")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Where ",(0,i.kt)("inlineCode",{parentName:"li"},"hshD7171OpG")," is the form id."),(0,i.kt)("li",{parentName:"ul"},"You can also pass the page size of data you want as:-",(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-JS"},"/api/records/duplicates/hshD7171OpG?pageSize=300\n")),(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Where ",(0,i.kt)("inlineCode",{parentName:"li"},"pageSize=300")," is the query for a page of size 300 items.")))),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Method:")," GET"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Payload")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-JSON"},' {\n  "pager": {\n    "page": 1,\n    "pageSize": 100,\n    "pageCount": 00,\n    "total": 1295,\n    "nextPage": "/api/records/duplicates/52893cd128bd2?page=2"\n  },\n  "records": [\n      {\n      "field": "b2fkEQgzJdbhF",\n      "name": "Check Number",\n      "duplicates": [\n        {\n          "id": "BPlMPfo553ch5",\n          "recordValues": [\n             {\n               "id": "nuDEzu4NBeL2Z",\n              "field": "iKJDfOQmtw2qp",\n              "value": "form four"\n            },\n            {\n              "id": "eTnrhDx2E45EG",\n              "field": "lJNeQk2bTNQl5",\n              "value": "jdjjd"\n            },\n          ],\n          "organisationunit": "zRgNXkU7Yef6L"\n        },\n        {\n          "id": "SspS99jTdRbn8",\n          "recordValues": [\n           {\n             "id":"kmfZvkYLiOWVu",\n              "field": "nTw32YiWJtwhl",\n              "value": "jdjjd"\n            },\n            {\n              "id":"ezFEgOAnPWNvs",\n              "field": "tRPYrDlb1n79w",\n              "value": "ndnndf"\n            },\n            {\n              "id":"E7NeVciipvtMv",\n              "field": "lWDS8Rwg70G9I",\n              "value": "nam"\n            }\n          ],\n          "organisationunit": "PXXhx3rjw6ebx"\n        }\n      ]\n    }\n  ]\n }\n')),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Payload Description")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The payload contains an array of Records and inside, objects. Each object contains a random character string value with key field which indicates the unique field used to get duplicates."),(0,i.kt)("li",{parentName:"ul"},"The same object contains another object with properties of id and recordValues, these indicate the record id and it's associated values respectively.")),(0,i.kt)("h2",{id:"merging-duplicates"},"Merging Duplicates"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Duplicates can be merged by two scenarios.")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Endpoint")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-JS"},"/api/records/merge\n")),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Method:")," POST"),(0,i.kt)("h3",{id:"scenario-one--based-on-records"},"Scenario One || Based on Records"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Payload")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n  "keep": "wuWlL5gTuzUf4",\n  "remove":["yxd7nZx3dExX9","ephzmm10i8Olc"]\n}\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Where ",(0,i.kt)("inlineCode",{parentName:"p"},"keep")," represents the recordid to keep and ",(0,i.kt)("inlineCode",{parentName:"p"},"remove")," represents an array of record ids to delete")),(0,i.kt)("h3",{id:"scenario-one--based-on-selected-fields"},"Scenario One || Based on Selected Fields"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"Payload")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-JSON"},'{\n  "organisationUnit":"XJpzOmbg7LuL6",\n  "form": "iJUMeqloMjmDq",\n  "recordValues": [\n      {"id": "jJBwwcYa1kBzQ"},\n      {"id": "fEbTGVMKVLUTU"},\n      {"id": "nlG8zObKlkMcx"}\n      ],\n  "remove":["yxd7nZx3dExX9","ephzmm10i8Olc"]\n}\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},"Where organisationUnit represents and form represents the parameters of the new record to create ",(0,i.kt)("inlineCode",{parentName:"p"},"recordValues")," represents an array of all recordvalue ids for all fields to create a new record and ",(0,i.kt)("inlineCode",{parentName:"p"},"remove")," represents an array of record ids to delete")),(0,i.kt)("h2",{id:"record-values"},"Record values"),(0,i.kt)("p",null,"This section is about sending and reading record values."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records\n")),(0,i.kt)("h3",{id:"sending-record-values"},"Sending record values"),(0,i.kt)("p",null,"A common use-case for system integration is the need to send a set of\nrecord values from a third-party system into HRHIS. In this example, we will\nuse the HRHIS demo on ",(0,i.kt)("inlineCode",{parentName:"p"},"http://dev.hrhis.HRHIS2udsm.org/demo")," as basis. We have now aggregated our data from source system and want to send that data to the HRHIS instance. The\nbase URL to the demo API is ",(0,i.kt)("inlineCode",{parentName:"p"},"http://dev.hrhis.HRHIS2udsm.org/demo/api"),". The following\nlinks are relative to the base URL."),(0,i.kt)("p",null,"The resource which is most appropriate for our purpose of sending data\nvalues is the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/records")," resource. A record values set represents a\nset of record values which have a relationship, usually from being\ncaptured off the same data entry form. The format looks like\nthis:"),(0,i.kt)("p",null,"JSON is supported in this format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "form": { "id": "formID" },\n  "organisationUnit": { "id": "orgUnitID" }, \n  // or we can use code in the format, organisationUnit: { "code": "orgUnitCODE" }\n  "recordValues": [\n    {\n      "value": "Bennett",\n      "field": { "id": "fieldID" },\n      "startdate": "startDate",\n      "startdate": "startDate"\n    },\n    {\n      "value": "Vincent",\n      "field": { "id": "fieldID" }\n    },\n    {\n      "value": "On Duty",\n      "field": { "id": "fieldID" }\n    }\n  ]\n}\n')),(0,i.kt)("blockquote",null,(0,i.kt)("p",{parentName:"blockquote"},(0,i.kt)("strong",{parentName:"p"},"Note")),(0,i.kt)("p",{parentName:"blockquote"},"The period identifiers(",(0,i.kt)("inlineCode",{parentName:"p"},"startDate")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"endDate"),") are for history records and hence not compulsory, required in certain values"),(0,i.kt)("p",{parentName:"blockquote"},"Please refer to the form and organisationUnit section above for time formats.")),(0,i.kt)("p",null,"From the example, we can see that we need to identify the period, the\ndata set, the org unit (facility) and the data elements for which to\nreport."),(0,i.kt)("p",null,"To obtain the identifier for the data set we make a request to the\n",(0,i.kt)("inlineCode",{parentName:"p"},"/api/forms")," resource. From there we find and follow the link to\nthe ",(0,i.kt)("em",{parentName:"p"},"Mortality < 5 years")," data set which leads us to ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/forms/pBOMPrpg1QX"),".\nThe resource representation for the ",(0,i.kt)("em",{parentName:"p"},"Mortality < 5 years")," data set conveniently\nadvertises links to the data elements which are members of it. From here\nwe can follow these links and obtain the identifiers of the data\nelements. For brevity we will only report on three data elements:\n",(0,i.kt)("em",{parentName:"p"},"Measles")," with id ",(0,i.kt)("inlineCode",{parentName:"p"},"f7n9E0hX8qk"),", ",(0,i.kt)("em",{parentName:"p"},"Dysentery")," with id ",(0,i.kt)("inlineCode",{parentName:"p"},"Ix2HsbDMLea")," and\n",(0,i.kt)("em",{parentName:"p"},"Cholera")," with id ",(0,i.kt)("inlineCode",{parentName:"p"},"eY5ehpbEsB7"),"."),(0,i.kt)("p",null,"What remains is to get hold of the identifier of the organisation\nunit. The ",(0,i.kt)("em",{parentName:"p"},"dataSet")," representation conveniently provides a link to organisation\nunits which report on it so we search for ",(0,i.kt)("em",{parentName:"p"},"Ngelehun CHC")," and follow the\nlink to the HTML representation at ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/organisationUnits/DiszpKrYNg8"),", which\ntells us that the identifier of this org unit is ",(0,i.kt)("inlineCode",{parentName:"p"},"DiszpKrYNg8"),"."),(0,i.kt)("p",null,"From our case-based data, we assume that we have 12 cases of measles, 14\ncases of dysentery and 16 cases of cholera. We have now gathered enough\ninformation to be able to put together the XML record values set\nmessage:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<recordValueset xmlns="http://HRHIS.org/schema/dxf/2.0" dataSet="pBOMPrpg1QX"\n  completeDate="2014-02-03" period="201401" orgUnit="DiszpKrYNg8">\n  <dataValue dataElement="f7n9E0hX8qk" value="12"/>\n  <dataValue dataElement="Ix2HsbDMLea" value="14"/>\n  <dataValue dataElement="eY5ehpbEsB7" value="16"/>\n</recordValueset>\n')),(0,i.kt)("p",null,"In JSON format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "dataSet": "pBOMPrpg1QX",\n  "completeDate": "2014-02-03",\n  "period": "201401",\n  "orgUnit": "DiszpKrYNg8",\n  "recordValues": [\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "value": "1"\n    },\n    {\n      "dataElement": "Ix2HsbDMLea",\n      "value": "2"\n    },\n    {\n      "dataElement": "eY5ehpbEsB7",\n      "value": "3"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"To perform functional testing we will use the ",(0,i.kt)("em",{parentName:"p"},"curl")," tool which provides\nan easy way of transferring data using HTTP. First, we save the data\nvalue set XML content in a file called ",(0,i.kt)("inlineCode",{parentName:"p"},"recordValueset.xml"),". From the\ndirectory where this file resides we invoke the following from the\ncommand line:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -d @recordValueset.xml "https://dev.hrhis.HRHIS2udsm.org/demo/api/records"\n  -H "Content-Type:application/xml" -u admin:district\n')),(0,i.kt)("p",null,"For sending JSON content you must set the content-type header\naccordingly:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -d @recordValueset.json "https://dev.hrhis.HRHIS2udsm.org/demo/api/records"\n  -H "Content-Type:application/json" -u admin:district\n')),(0,i.kt)("p",null,"The command will dispatch a request to the demo Web API, set\n",(0,i.kt)("inlineCode",{parentName:"p"},"application/xml")," as the content-type and authenticate using\n",(0,i.kt)("inlineCode",{parentName:"p"},"admin"),"/",(0,i.kt)("inlineCode",{parentName:"p"},"district")," as username/password. If all goes well this will return a\n",(0,i.kt)("inlineCode",{parentName:"p"},"200 OK")," HTTP status code. You can verify that the data has been\nreceived by opening the data entry module in HRHIS and select the org\nunit, data set and period used in this example."),(0,i.kt)("p",null,"The API follows normal semantics for error handling and HTTP status\ncodes. If you supply an invalid username or password, ",(0,i.kt)("inlineCode",{parentName:"p"},"401 Unauthorized"),"\nis returned. If you supply a content-type other than ",(0,i.kt)("inlineCode",{parentName:"p"},"application/xml"),",\n",(0,i.kt)("inlineCode",{parentName:"p"},"415 Unsupported Media Type")," is returned. If the XML content is invalid\naccording to the DXF namespace, ",(0,i.kt)("inlineCode",{parentName:"p"},"400 Bad Request")," is returned. If you\nprovide an invalid identifier in the XML content, ",(0,i.kt)("inlineCode",{parentName:"p"},"409 Conflict")," is\nreturned together with a descriptive message."),(0,i.kt)("h3",{id:"sending-bulks-of-record-values"},"Sending bulks of record values"),(0,i.kt)("p",null,"The previous example showed us how to send a set of related record values\nsharing the same period and organisation unit. This example will show us\nhow to send large bulks of record values which don't necessarily are\nlogically related."),(0,i.kt)("p",null,"Again we will interact with the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/records")," resource. This time we\nwill not specify the ",(0,i.kt)("inlineCode",{parentName:"p"},"dataSet")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"completeDate")," attributes. Also, we will\nspecify the ",(0,i.kt)("inlineCode",{parentName:"p"},"period")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"orgUnit")," attributes on the individual record values\nelements instead of on the outer record values set element. This will\nenable us to send record values for various periods and organisation units:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<recordValueset xmlns="http://HRHIS.org/schema/dxf/2.0">\n  <dataValue dataElement="f7n9E0hX8qk"\n    period="201401" orgUnit="DiszpKrYNg8" value="12"/>\n  <dataValue dataElement="f7n9E0hX8qk"\n    period="201401" orgUnit="FNnj3jKGS7i" value="14"/>\n  <dataValue dataElement="f7n9E0hX8qk"\n    period="201402" orgUnit="DiszpKrYNg8" value="16"/>\n  <dataValue dataElement="f7n9E0hX8qk"\n    period="201402" orgUnit="Jkhdsf8sdf4" value="18"/>\n</recordValueset>\n')),(0,i.kt)("p",null,"In JSON format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "recordValues": [\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8",\n      "value": "12"\n    },\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "period": "201401",\n      "orgUnit": "FNnj3jKGS7i",\n      "value": "14"\n    },\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "period": "201402",\n      "orgUnit": "DiszpKrYNg8",\n      "value": "16"\n    },\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "period": "201402",\n      "orgUnit": "Jkhdsf8sdf4",\n      "value": "18"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"In CSV format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csv"},'"dataelement","period","orgunit","categoryoptioncombo","attributeoptioncombo","value"\n"f7n9E0hX8qk","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","1"\n"Ix2HsbDMLea","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","2"\n"eY5ehpbEsB7","201401","DiszpKrYNg8","bRowv6yZOF2","bRowv6yZOF2","3"\n')),(0,i.kt)("p",null,"We test by using curl to send the record values in XML format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -d @recordValueset.xml "https://dev.hrhis.HRHIS2udsm.org/demo/api/records"\n  -H "Content-Type:application/xml" -u admin:district\n')),(0,i.kt)("p",null,"Note that when using CSV format you must use the binary data option to\npreserve the line-breaks in the CSV file:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl --data-binary @recordValueset.csv "https://dev.hrhis.HRHIS2udsm.org/demo/24/api/records"\n  -H "Content-Type:application/csv" -u admin:district\n')),(0,i.kt)("p",null,"The record values set resource provides an XML response which is useful\nwhen you want to verify the impact your request had. The first time we\nsend the record values set request above the server will respond with the\nfollowing import summary:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<importSummary>\n  <dataValueCount imported="2" updated="1" ignored="1"/>\n  <dataSetComplete>false</dataSetComplete>\n</importSummary>\n')),(0,i.kt)("p",null,"This message tells us that 3 record values were imported, 1 record values was\nupdated while zero record values were ignored. The single update comes as\na result of us sending that record values in the previous example. A data\nvalue will be ignored if it references a non-existing data element,\nperiod, org unit or data set. In our case, this single ignored value was\ncaused by the last record values having an invalid reference to org unit.\nThe data set complete element will display the date of which the data\nvalue set was completed, or false if no data element attribute was\nsupplied."),(0,i.kt)("h3",{id:"import-parameters"},"Import parameters"),(0,i.kt)("p",null,"The import process can be customized using a set of import parameters:"),(0,i.kt)("p",null,"All parameters are optional and can be supplied as query parameters in\nthe request URL like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records?dataElementIdScheme=code&orgUnitIdScheme=name\n  &dryRun=true&importStrategy=CREATE\n")),(0,i.kt)("p",null,"They can also be supplied as XML attributes on the record values set\nelement like below. XML attributes will override query string\nparameters."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<recordValueset xmlns="http://HRHIS.org/schema/dxf/2.0" dataElementIdScheme="code"\n  orgUnitIdScheme="name" dryRun="true" importStrategy="CREATE">\n</recordValueset>\n')),(0,i.kt)("p",null,"Note that the ",(0,i.kt)("inlineCode",{parentName:"p"},"preheatCache")," parameter can have a huge impact on\nperformance. For small import files, leaving it to false will be fast.\nFor large import files which contain a large number of distinct data\nelements and organisation units, setting it to true will be orders of\nmagnitude faster."),(0,i.kt)("h4",{id:"record-values-requirements"},"record values requirements"),(0,i.kt)("p",null,"record values import supports a set of value types. For each value type,\nthere is a special requirement. The following table lists the edge cases\nfor value types."),(0,i.kt)("h4",{id:"identifier-schemes"},"Identifier schemes"),(0,i.kt)("p",null,"Regarding the id schemes, by default the identifiers used in the XML\nmessages use the HRHIS stable object identifiers referred to as ",(0,i.kt)("inlineCode",{parentName:"p"},"UID"),".\nIn certain interoperability situations we might experience that an external\nsystem decides the identifiers of the objects. In that case we can use\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"code")," property of the organisation units and other objects to set\nfixed identifiers. When importing record values we hence need to reference\nthe code property instead of the identifier property of these metadata\nobjects. Identifier schemes can be specified in the XML message as well\nas in the request as query parameters. To specify it in the XML payload\nyou can do this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<recordValueset xmlns="http://HRHIS.org/schema/dxf/2.0"\n  dataElementIdScheme="CODE" orgUnitIdScheme="UID" idScheme="CODE">\n</recordValueset>\n')),(0,i.kt)("p",null,"The parameter table above explains how the id schemes can be specified\nas query parameters. The following rules apply for what takes\nprecedence:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Id schemes defined in the XML or JSON payload take precedence over\nid schemes defined as URL query parameters.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Specific id schemes including dataElementIdScheme and\norgUnitIdScheme take precedence over the general idScheme.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"The default id scheme is UID, which will be used if no explicit id\nscheme is defined."))),(0,i.kt)("p",null,"The following identifier schemes are available."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"uid (default)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"code")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"name")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"attribute (followed by UID of attribute)"))),(0,i.kt)("p",null,"The attribute option is special and refers to meta-data attributes which\nhave been marked as ",(0,i.kt)("em",{parentName:"p"},"unique"),". When using this option, ",(0,i.kt)("inlineCode",{parentName:"p"},"attribute"),' must\nbe immediately followed by the identifier of the attribute, e.g.\n"attribute:DnrLSdo4hMl".'),(0,i.kt)("h4",{id:"async-record-values-import"},"Async record values import"),(0,i.kt)("p",null,"Record values can be sent and imported in an asynchronous fashion by\nsupplying an ",(0,i.kt)("inlineCode",{parentName:"p"},"async")," query parameter set to ",(0,i.kt)("em",{parentName:"p"},"true"),":"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records?async=true\n")),(0,i.kt)("p",null,"This will initiate an asynchronous import job for which you can monitor\nthe status at the task summaries API. The API response indicates the\nunique identifier of the job, type of job and the URL you can use to\nmonitor the import job status. The response will look similar to this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "httpStatus": "OK",\n  "httpStatusCode": 200,\n  "status": "OK",\n  "message": "Initiated dataValueImport",\n  "response": {\n    "name": "dataValueImport",\n    "id": "YR1UxOUXmzT",\n    "created": "2018-08-20T14:17:28.429",\n    "jobType": "DATAVALUE_IMPORT",\n    "relativeNotifierEndpoint": "/api/system/tasks/DATAVALUE_IMPORT/YR1UxOUXmzT"\n  }\n}\n')),(0,i.kt)("p",null,"Please read the section on ",(0,i.kt)("em",{parentName:"p"},"asynchronous task status")," for more\ninformation."),(0,i.kt)("h3",{id:"csv-record-values-format"},"CSV record values format"),(0,i.kt)("p",null,"The following section describes the CSV format used in HRHIS. The first\nrow is assumed to be a header row and will be ignored during import."),(0,i.kt)("p",null,"An example of a CSV file which can be imported into HRHIS is seen below."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csv"},'"dataelement","period","orgunit","catoptcombo","attroptcombo","value","storedby","timestamp"\n"DUSpd8Jq3M7","201202","gP6hn503KUX","Prlt0C1RF0s",,"7","bombali","2010-04-17"\n"DUSpd8Jq3M7","201202","gP6hn503KUX","V6L425pT3A0",,"10","bombali","2010-04-17"\n"DUSpd8Jq3M7","201202","OjTS752GbZE","V6L425pT3A0",,"9","bombali","2010-04-06"\n')),(0,i.kt)("h3",{id:"generating-record-values-set-template"},"Generating record values set template"),(0,i.kt)("p",null,"To generate a record values set template for a certain data set you can use\nthe ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/forms/<id>/recordValueset")," resource. XML and JSON response\nformats are supported. Example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/forms/BfMAe6Itzgt/recordValueset.json\n")),(0,i.kt)("p",null,"The parameters you can use to further adjust the output are described\nbelow:"),(0,i.kt)("h3",{id:"reading-record-values"},"Reading record values"),(0,i.kt)("p",null,"This section explains how to retrieve record values from the Web API by\ninteracting with the ",(0,i.kt)("em",{parentName:"p"},"recordValues")," resource. Record values can be\nretrieved in ",(0,i.kt)("em",{parentName:"p"},"XML"),", ",(0,i.kt)("em",{parentName:"p"},"JSON")," and ",(0,i.kt)("em",{parentName:"p"},"CSV")," format. Since we want to read data\nwe will use the ",(0,i.kt)("em",{parentName:"p"},"GET")," HTTP verb. We will also specify that we are\ninterested in the XML resource representation by including an ",(0,i.kt)("inlineCode",{parentName:"p"},"Accept"),"\nHTTP header with our request. The following query parameters are\nrequired:"),(0,i.kt)("p",null,"The following response formats are supported:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"xml (application/xml)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"json (application/json)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"csv (application/csv)")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"adx (application/adx+xml)"))),(0,i.kt)("p",null,"Assuming that we have posted record values to HRHIS according to the\nprevious section called ",(0,i.kt)("em",{parentName:"p"},"Sending record values")," we can now put together\nour request for a single record values set and request it using cURL:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.HRHIS2udsm.org/demo/api/records?dataSet=pBOMPrpg1QX&period=201401&orgUnit=DiszpKrYNg8"\n  -H "Accept:application/xml" -u admin:district\n')),(0,i.kt)("p",null,"We can also use the start and end dates query parameters to request a\nlarger bulk of record values. I.e. you can also request record values for\nmultiple data sets and org units and a time span in order to export\nlarger chunks of data. Note that the period query parameter takes\nprecedence over the start and end date parameters. An example looks like\nthis:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.HRHIS2udsm.org/demo/api/records?dataSet=pBOMPrpg1QX&dataSet=BfMAe6Itzgt\n  &startDate=2013-01-01&endDate=2013-01-31&orgUnit=YuQRtpLP10I&orgUnit=vWbkYPRmKyS&children=true"\n  -H "Accept:application/xml" -u admin:district\n')),(0,i.kt)("p",null,"To retrieve record values which have been created or updated within the\nlast 10 days you can make a request like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records?dataSet=pBOMPrpg1QX&orgUnit=DiszpKrYNg8&lastUpdatedDuration=10d\n")),(0,i.kt)("p",null,"The response will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-xml"},'<?xml version=\'1.0\' encoding=\'UTF-8\'?>\n<recordValueset xmlns="http://HRHIS.org/schema/dxf/2.0" dataSet="pBOMPrpg1QX"\n  completeDate="2014-01-02" period="201401" orgUnit="DiszpKrYNg8">\n<dataValue dataElement="eY5ehpbEsB7" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10003"/>\n<dataValue dataElement="Ix2HsbDMLea" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10002"/>\n<dataValue dataElement="f7n9E0hX8qk" period="201401" orgUnit="DiszpKrYNg8"\n  categoryOptionCombo="bRowv6yZOF2" value="10001"/>\n</recordValueset>\n')),(0,i.kt)("p",null,"You can request the data in JSON format like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records.json?dataSet=pBOMPrpg1QX&period=201401&orgUnit=DiszpKrYNg8\n")),(0,i.kt)("p",null,"The response will look something like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "dataSet": "pBOMPrpg1QX",\n  "completeDate": "2014-02-03",\n  "period": "201401",\n  "orgUnit": "DiszpKrYNg8",\n  "recordValues": [\n    {\n      "dataElement": "eY5ehpbEsB7",\n      "categoryOptionCombo": "bRowv6yZOF2",\n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8",\n      "value": "10003"\n    },\n    {\n      "dataElement": "Ix2HsbDMLea",\n      "categoryOptionCombo": "bRowv6yZOF2",\n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8",\n      "value": "10002"\n    },\n    {\n      "dataElement": "f7n9E0hX8qk",\n      "categoryOptionCombo": "bRowv6yZOF2",\n      "period": "201401",\n      "orgUnit": "DiszpKrYNg8",\n      "value": "10001"\n    }\n  ]\n}\n')),(0,i.kt)("p",null,"Note that record values are softly deleted, i.e. a deleted value has the\n",(0,i.kt)("inlineCode",{parentName:"p"},"deleted")," property set to true instead of being permanently deleted.\nThis is useful when integrating multiple systems in order to communicate\ndeletions. You can include deleted values in the response like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records.json?dataSet=pBOMPrpg1QX&period=201401\n  &orgUnit=DiszpKrYNg8&includeDeleted=true\n")),(0,i.kt)("p",null,"You can also request data in CSV format like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/records.csv?dataSet=pBOMPrpg1QX&period=201401\n  &orgUnit=DiszpKrYNg8\n")),(0,i.kt)("p",null,"The response will look like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-csv"},"dataelement,period,orgunit,catoptcombo,attroptcombo,value,storedby,lastupdated,comment,flwup\nf7n9E0hX8qk,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,12,system,2015-04-05T19:58:12.000,comment1,false\nIx2HsbDMLea,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,14,system,2015-04-05T19:58:12.000,comment2,false\neY5ehpbEsB7,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,16,system,2015-04-05T19:58:12.000,comment3,false\nFTRrcoaog83,201401,DiszpKrYNg8,bRowv6yZOF2,bRowv6yZOF2,12,system,2014-03-02T21:45:05.519,comment4,false\n")),(0,i.kt)("p",null,"The following constraints apply to the record values sets resource:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"At least one data set must be specified.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Either at least one period or a start date and end date must be\nspecified.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"At least one organisation unit must be specified.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Organisation units must be within the hierarchy of the organisation\nunits of the authenticated user.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},"Limit cannot be less than zero."))),(0,i.kt)("h3",{id:"sending-reading-and-deleting-individual-record-values"},"Sending, reading and deleting individual record values"),(0,i.kt)("p",null,"This example will show how to send individual record values to be saved in\na request. This can be achieved by sending a ",(0,i.kt)("em",{parentName:"p"},"POST")," request to the\n",(0,i.kt)("inlineCode",{parentName:"p"},"recordValues")," resource:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"/api/recordValues\n")),(0,i.kt)("p",null,"The following query parameters are supported for this resource:"),(0,i.kt)("p",null,"If any of the identifiers given are invalid, if the record value or\ncomment is invalid or if the data is locked, the response will contain\nthe ",(0,i.kt)("em",{parentName:"p"},"409 Conflict")," status code and descriptive text message. If the\noperation leads to a saved or updated value, ",(0,i.kt)("em",{parentName:"p"},"200 OK")," will be returned.\nAn example of a request looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.HRHIS2udsm.org/demo/api/recordValues?de=s46m5MS0hxu\n  &pe=201301&ou=DiszpKrYNg8&co=Prlt0C1RF0s&value=12"\n  -X POST -u admin:district\n')),(0,i.kt)("p",null,"This resource also allows a special syntax for associating the value to\nan attribute option combination. This can be done by sending the\nidentifier of the attribute category combination, together with the identifiers\nof the attribute category options which the value represents within the\ncombination. The category combination is specified with the ",(0,i.kt)("inlineCode",{parentName:"p"},"cc")," parameter, while\nthe category options are specified as a semi-colon separated string with the ",(0,i.kt)("inlineCode",{parentName:"p"},"cp"),"\nparameter. It is necessary to ensure that the category options are all part\nof the category combination. An example looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.HRHIS2udsm.org/demo/api/recordValues?de=s46m5MS0hxu&ou=DiszpKrYNg8\n  &pe=201308&cc=dzjKKQq0cSO&cp=wbrDrL2aYEc;btOyqprQ9e8&value=26"\n  -X POST -u admin:district\n')),(0,i.kt)("p",null,"You can retrieve a record values with a request using the ",(0,i.kt)("em",{parentName:"p"},"GET")," method. The\nvalue, comment and followUp params are not applicable in this regard:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl "https://dev.hrhis.HRHIS2udsm.org/demo/api/recordValues?de=s46m5MS0hxu\n  &pe=201301&ou=DiszpKrYNg8&co=Prlt0C1RF0s"\n  -u admin:district\n')),(0,i.kt)("p",null,"You can delete a record value with a request using the ",(0,i.kt)("em",{parentName:"p"},"DELETE")," method."),(0,i.kt)("h4",{id:"working-with-file-record-values"},"Working with file record values"),(0,i.kt)("p",null,"When dealing with record values which have a data element of type ",(0,i.kt)("em",{parentName:"p"},"file"),"\nthere is some deviation from the method described above. These data\nvalues are special in that the contents of the value is a UID reference\nto a ",(0,i.kt)("em",{parentName:"p"},"FileResource")," object instead of a self-contained constant. These\nrecord values will behave just like other record values which store text\ncontent, but should be handled differently in order to produce\nmeaningful input and output."),(0,i.kt)("p",null,"The process of storing one of these record values roughly goes like this:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Upload the file to the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/fileResources")," endpoint as described\nin the file resource section.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Retrieve the ",(0,i.kt)("inlineCode",{parentName:"p"},"id")," property of the returned ",(0,i.kt)("em",{parentName:"p"},"FileResource"),".")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Store the retrieved id ",(0,i.kt)("em",{parentName:"p"},"as the value")," to the record values using any\nof the methods described above."))),(0,i.kt)("p",null,"Only one-to-one relationships between record values and file resources are\nallowed. This is enforced internally so that saving a file resource id\nin several record values is not allowed and will return an error. Deleting\nthe record values will delete the referenced file resource. Direct deletion\nof file resources are not possible."),(0,i.kt)("p",null,"The record values can now be retrieved as any other but the returned data\nwill be the UID of the file resource. In order to retrieve the actual\ncontents (meaning the file which is stored in the file resource mapped\nto the record values) a GET request must be made to ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/recordValues/files"),"\nmirroring the query parameters as they would be for the record values\nitself. The ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/recordValues/files")," endpoint only supports GET requests."),(0,i.kt)("p",null,"It is worth noting that due to the underlying storage mechanism working\nasynchronously the file content might not be immediately ready for\ndownload from the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/recordValues/files")," endpoint. This is especially true\nfor large files which might require time consuming uploads happening in\nthe background to an external file store (depending on the system\nconfiguration). Retrieving the file resource meta-data from the\n",(0,i.kt)("inlineCode",{parentName:"p"},"/api/fileResources/<id>")," endpoint allows checking the ",(0,i.kt)("inlineCode",{parentName:"p"},"storageStatus"),"\nof the content before attempting to download it.\n--\x3e"))}c.isMDXComponent=!0}}]);